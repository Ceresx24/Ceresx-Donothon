<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ceres Donothon — Control Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-database-compat.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@600&display=swap" rel="stylesheet">
<style>
  :root{--bg:#0d0b1c;--card:#14132b;--accent:#a855f7;--accent2:#c17aff;--text:#e2e8f0;--muted:#94a3b8;--success:#00ffaa;--danger:#ff3366;--border:#2d2a57}
  *{box-sizing:border-box}
  body{margin:0;padding:0;font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);background-image:radial-gradient(circle at top right,#1a1650 0%,transparent 50%);min-height:100vh}
  .container{max-width:1400px;margin:0 auto;padding:20px}
  header{text-align:center;padding:30px 0;border-bottom:1px solid var(--border);margin-bottom:30px}
  header h1{font-size:44px;margin:0;background:linear-gradient(90deg,#a855f7,#00e5ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
  header p{color:var(--muted);font-size:18px;margin:8px 0 0}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(360px,1fr));gap:24px}
  .card{background:var(--card);border-radius:16px;padding:28px;border:1px solid var(--border);box-shadow:0 8px 32px rgba(0,0,0,0.4);transition:.3s}
  .card:hover{transform:translateY(-4px);box-shadow:0 16px 40px rgba(0,0,0,0.5)}
  .card h2{margin:0 0 20px;font-size:24px;color:var(--accent);display:flex;align-items:center;gap:10px}
  .card h2::before{content:"▹";color:var(--accent)}
  input,button{width:100%;padding:14px 16px;border-radius:12px;border:none;font-size:16px;margin:8px 0;background:#1e1c38;color:var(--text);transition:.2s}
  input:focus,button:focus{outline:none;box-shadow:0 0 0 3px rgba(168,85,247,0.3)}
  button{background:var(--accent);color:white;font-weight:600;cursor:pointer}
  button:hover{background:var(--accent2);transform:translateY(-2px)}
  button.success{background:#00c853} button.danger{background:var(--danger)}
  .live-preview{background:linear-gradient(135deg,#14132b,#0f0f22);padding:32px;border-radius:16px;text-align:center;border:1px solid var(--border)}
  #liveTimer{font-family:'JetBrains Mono',monospace;font-size:88px;font-weight:700;margin:20px 0;background:linear-gradient(90deg,#00ffaa,#00e5ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
  .status{display:inline-block;padding:8px 24px;border-radius:50px;font-size:15px;font-weight:600;background:#333;color:#ff9800;margin-top:12px}
  .goal-item{background:#1e1c38;padding:14px 18px;border-radius:12px;margin:10px 0;display:flex;align-items:center;gap:12px;flex-wrap:wrap;border-left:4px solid var(--accent)}
  .goal-item input{flex:1;min-width:200px}
  .goal-item button{width:auto;padding:8px 16px;font-size:14px}
  .checkbox-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin:16px 0}
  label{display:flex;align-items:center;gap:10px;cursor:pointer;font-size:15px;color:var(--muted)}
  input[type=checkbox]{width:auto;transform:scale(1.3);accent-color:var(--accent)}
  footer{text-align:center;padding:40px 0;color:#64748b;font-size:14px}
</style>
</head>
<body>

<div class="container">

<header>
  <h1>Ceres Donothon Control Panel</h1>
  <p>Professional • Real-time • Fully Customizable</p>
</header>

<div class="live-preview">
  <h2 style="margin:0;color:#fff">Donothon by <span id="liveName">Ceres</span></h2>
  <div id="liveTimer">03:00:00</div>
  <div style="font-size:28px">Raised: $<span id="liveRaised">0.00</span> • Subs: <span id="liveSubs">0</span> • Bits: <span id="liveBits">0</span></div>
  <div class="status" id="status">STOPPED</div>
</div>

<div class="grid" style="margin-top:30px">
  <div class="card">
    <h2>Timer Control</h2>
    <button class="success" style="padding:20px;font-size:20px" onclick="startTimer()">START 3-HOUR TIMER</button>
    <button id="pauseBtn" style="margin:15px 0;padding:16px;font-size:18px" onclick="togglePause()">PAUSE</button>
    <button class="danger" onclick="if(confirm('Reset EVERYTHING?'))resetAll()">RESET ALL DATA</button>
  </div>

  <div class="card">
    <h2>Manual Add</h2>
    <input type="number" step="0.01" id="addMoney" placeholder="Add donation ($)">
    <input type="number" id="addMinutes" placeholder="Add minutes">
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px">
      <button onclick="addMoneyAndTime()">Add $ + Time</button>
      <button onclick="addMoneyOnly()">Add $ Only (+1min/$)</button>
    </div>
    <button style="margin-top:10px" onclick="addTimeOnly()">Add Time Only</button>
  </div>

  <div class="card">
    <h2>Appearance</h2>
    <input id="streamerName" placeholder="Streamer name">
    <button style="margin-top:8px" onclick="updateName()">Update Name</button>
    <hr style="border-color:#333;margin:20px 0">
    <label>Goal Box Scale: <span id="scaleValue">100</span>%</label>
    <input type="range" min="50" max="200" value="100" id="goalScale" oninput="document.getElementById('scaleValue').textContent=this.value">
    <button onclick="saveGoalScale()">Apply Scale</button>
  </div>
</div>

<div class="card" style="margin-top:30px">
  <h2>Milestones</h2>
  <div class="goal-list" id="goalList"></div>
  <div style="margin-top:20px;display:flex;gap:10px;flex-wrap:wrap">
    <input placeholder="Amount $" id="newAmt" style="width:150px">
    <input placeholder="Description" id="newDesc" style="flex:1">
    <button onclick="addGoal()">+ Add Milestone</button>
  </div>
</div>

<div class="grid">
  <div class="card">
    <h2>Theme Colors</h2>
    <label>Accent</label><input type="color" id="ac" value="#a855f7" onchange="save('accent',this.value)">
    <label>Text</label><input type="color" id="txt" value="#ffffff" onchange="save('text',this.value)">
    <label>Gradient</label>
    <div style="display:flex;gap:10px"><input type="color" id="g1" value="#a855f7"><input type="color" id="g2" value="#00e5ff" onchange="save('grad1',document.getElementById('g1').value);save('grad2',this.value)"></div>
    <label>Checkmark</label><input type="color" id="chk" value="#00ffaa" onchange="save('check',this.value)">
    <button style="margin-top:15px" onclick="saveColors()">Save All Colors</button>
  </div>

  <div class="card">
    <h2>Visibility & Sound</h2>
    <div class="checkbox-grid">
      <label><input type="checkbox" id="hideSubs" onchange="ref.child('theme/hideSubs').set(this.checked)"> Hide Subs/Bits</label>
      <label><input type="checkbox" id="hideGoal" onchange="ref.child('theme/hideGoal').set(this.checked)"> Hide Goal Text</label>
      <label><input type="checkbox" id="hideFooter" onchange="ref.child('theme/hideFooter').set(this.checked)"> Hide Footer</label>
    </div>
    <hr style="border-color:#333;margin:20px 0">
    <label>Celebration Sound (empty = RuneScape)</label>
    <input id="soundUrl" placeholder="https://...">
    <button style="margin-top:8px" onclick="ref.child('theme/sound').set(document.getElementById('soundUrl').value.trim()||null)">Save Sound</button>
  </div>
</div>

<footer>Ceres Donothon Timer • Professional Edition • 2025</footer>

</div>

<script>
const PATH = 'donothon-ultimate-2025-x7k9p2m4q8z3v6n1';
const PASSWORDS = ['Rin125','125','Rinmod125'];
firebase.initializeApp({apiKey:"AIzaSyBFQFPo85fIpaHWl3Kr0PZ6WIm5B6WVusA",authDomain:"ceres-donothon-timer.firebaseapp.com",databaseURL:"https://ceres-donothon-timer-default-rtdb.firebaseio.com",projectId:"ceres-donothon-timer"});
const ref = firebase.database().ref(PATH);

// Login
const pw = prompt('Enter password:');
if(!PASSWORDS.includes(pw||'')){ alert('Wrong password'); close(); }

// Live update
setInterval(updateLive, 500);
ref.on('value', s => {
  const d = s.val()||{};
  document.getElementById('status').textContent = d.paused?'PAUSED':(d.endTime?'LIVE':'STOPPED');
  document.getElementById('pauseBtn').textContent = d.paused?'RESUME':'PAUSE';
});
ref.child('settings/streamerName').on('value', s => document.getElementById('liveName').textContent = s.val()||'Ceres');
ref.child('config/milestones').on('value', renderGoals);
ref.child('theme').on('value', s => loadTheme(s.val()||{}));

function updateLive(){
  ref.once('value').then(s => {
    const d = s.val()||{};
    let left = 0;
    if(d.endTime){
      const bonus = (d.bonusSeconds||0)*1000;
      const target = d.paused && d.pausedAt ? d.pausedAt + bonus : d.endTime + bonus;
      left = Math.max(0, Math.floor((target - Date.now())/1000));
    }
    const h=('0'+Math.floor(left/3600)).slice(-2);
    const m=('0'+Math.floor(left%3600/60)).slice(-2);
    const s=('0'+left%60).slice(-2);
    document.getElementById('liveTimer').textContent = `${h}:${m}:${s}`;
    document.getElementById('liveRaised').textContent = (d.totalEarned||0).toFixed(2);
    document.getElementById('liveSubs').textContent = d.subsCount||0;
    document.getElementById('liveBits').textContent = d.bitsCount||0;
  });
}

// FIXED PAUSE/RESUME
function togglePause(){
  ref.once('value').then(snap => {
    const d = snap.val() || {};
    if(d.paused){
      // RESUME
      const remainingSeconds = Math.floor((d.pausedAt + (d.bonusSeconds||0)*1000 - Date.now())/1000);
      const newEndTime = Date.now() + remainingSeconds*1000;
      ref.update({ endTime: newEndTime, paused: false, pausedAt: null });
    } else {
      // PAUSE
      ref.update({ paused: true, pausedAt: Date.now() });
    }
  });
}

function startTimer(){ ref.update({endTime:Date.now()+3*60*60*1000, bonusSeconds:0, paused:false, pausedAt:null}); }
function addMoneyAndTime(){ const m=+document.getElementById('addMoney').value||0; const t=+document.getElementById('addMinutes').value||0; if(m||t) ref.transaction(d=>{d.totalEarned=(d.totalEarned||0)+m; d.bonusSeconds=(d.bonusSeconds||0)+t*60; return d;}); document.getElementById('addMoney').value=''; document.getElementById('addMinutes').value=''; }
function addMoneyOnly(){ const m=+document.getElementById('addMoney').value||0; if(m) ref.transaction(d=>{d.totalEarned=(d.totalEarned||0)+m; d.bonusSeconds=(d.bonusSeconds||0)+m*60; return d;}); document.getElementById('addMoney').value=''; }
function addTimeOnly(){ const t=+document.getElementById('addMinutes').value||0; if(t) ref.child('bonusSeconds').transaction(v=>(v||0)+t*60); document.getElementById('addMinutes').value=''; }
function updateName(){ ref.child('settings/streamerName').set(document.getElementById('streamerName').value.trim()||'Ceres'); }
function saveGoalScale(){ ref.child('theme/goalScale').set(document.getElementById('goalScale').value/100); }
function addGoal(){ const a=+document.getElementById('newAmt').value; const desc=document.getElementById('newDesc').value.trim(); if(a&&desc) ref.child('config/milestones').push({amount:a,description:desc}); document.getElementById('newAmt').value=''; document.getElementById('newDesc').value=''; }
function renderGoals(s){ const goals=s.val()||{}; const list=document.getElementById('goalList'); list.innerHTML=''; Object.entries(goals).sort((a,b)=>a[1].amount-b[1].amount).forEach(([id,g])=>{ const div=document.createElement('div'); div.className='goal-item'; div.innerHTML=`<span>$${g.amount}</span><input value="${g.description}" onchange="ref.child('config/milestones/${id}/description').set(this.value)"><button style="background:#e91e63" onclick="ref.child('config/milestones/${id}').remove()">Delete</button>`; list.appendChild(div); }); }
function save(k,v){ ref.child('theme').child(k).set(v); }
function saveColors(){ save('accent',document.getElementById('ac').value); save('text',document.getElementById('txt').value); save('grad1',document.getElementById('g1').value); save('grad2',document.getElementById('g2').value); save('check',document.getElementById('chk').value); }
function loadTheme(t){ if(t.goalScale) document.getElementById('goalScale').value = t.goalScale*100; document.getElementById('scaleValue').textContent = Math.round((t.goalScale||1)*100); ['hideSubs','hideGoal','hideFooter'].forEach(k=>document.getElementById(k)&&t[k]?document.getElementById(k).checked=true:null); }
function resetAll(){ if(confirm('NUKE EVERYTHING?')) ref.set({config:{milestones:{},goal:10000},settings:{},theme:{},totalEarned:0,bonusSeconds:0,endTime:null,paused:false,pausedAt:null,subsCount:0,bitsCount:0}); }
</script>
</body>
</html>
