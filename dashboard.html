<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ceres Donothon — Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-database-compat.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@600&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0d0b1c; --card:#14132b; --accent:#a855f7; --accent2:#c17aff; 
  --text:#e2e8f0; --success:#00ffaa; --danger:#ff3366; --border:#2d2a57;
  --timerFont:'JetBrains Mono',monospace; --titleFont:'Inter',sans-serif;
}
*{box-sizing:border-box;margin:0;padding:0;font-family:var(--titleFont);}
body{background:var(--bg);color:var(--text);min-height:100vh;display:flex;justify-content:center;align-items:flex-start;padding:20px;}
#loginScreen, #main{width:420px;max-width:95vw;}
#loginScreen{background:linear-gradient(135deg,#14132b,#0f0f22);padding:50px 40px;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,.6);text-align:center;border:1px solid var(--border);}
#loginScreen h1{font-size:32px;margin-bottom:10px;background:linear-gradient(90deg,#a855f7,#00e5ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
input,button{width:100%;padding:14px 16px;border-radius:12px;border:none;font-size:16px;margin:8px 0;background:#1e1c38;color:var(--text);}
button{background:var(--accent);color:white;font-weight:600;cursor:pointer;transition:.2s;}
button:hover{background:var(--accent2);transform:translateY(-2px);}
button.success{background:var(--success);} button.danger{background:var(--danger);}
.grid{display:grid;grid-template-columns:1fr;gap:20px;margin-top:20px;}
.card{background:var(--card);border-radius:16px;padding:20px;border:1px solid var(--border);box-shadow:0 8px 32px rgba(0,0,0,.4);}
.card h2{font-size:20px;color:var(--accent);margin-bottom:15px;}
.live-preview{background:linear-gradient(135deg,#14132b,#0f0f22);padding:25px;border-radius:16px;text-align:center;border:1px solid var(--border);margin-bottom:20px;}
#liveTimer{font-family:var(--timerFont);font-size:60px;background:linear-gradient(90deg,#00ffaa,#00e5ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:10px;}
.slider-grid{display:grid;grid-template-columns:1fr auto;gap:12px;align-items:center;margin:10px 0;}
.value{min-width:50px;text-align:right;padding:6px 10px;background:#1e1c38;border-radius:8px;font-weight:600;}
.quick-add{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:10px;}
</style>
</head>
<body>

<div id="loginScreen">
  <h1>CERES DONOTHON</h1>
  <input type="password" id="pw" placeholder="Password" autofocus>
  <button onclick="login()">UNLOCK</button>
</div>

<div id="main" style="display:none;max-width:900px;width:100%;">
  <div class="live-preview">
    <h2>Donothon by <span id="liveName">Ceres</span></h2>
    <div id="liveTimer">03:00:00</div>
    <div style="font-size:18px;">Raised: $<span id="liveRaised">0.00</span> • Subs: <span id="liveSubs">0</span> • Bits: <span id="liveBits">0</span></div>
    <div class="status" id="status">STOPPED</div>
  </div>

  <div class="grid">
    <div class="card">
      <h2>Socket Token (Streamlabs / SE)</h2>
      <input type="text" id="socketToken" placeholder="Paste token here">
      <button class="success" onclick="saveSocketToken()">SAVE & CONNECT</button>
      <div style="margin-top:6px;font-weight:600;color:var(--success)" id="socketStatus">Not connected</div>
    </div>

    <div class="card">
      <h2>Timer Control</h2>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
        <input type="number" id="startHours" value="3" min="0">
        <input type="number" id="startMinutes" value="0" min="0" max="59">
      </div>
      <button class="success" onclick="startTimer()">START TIMER</button>
      <button id="pauseBtn" class="success" onclick="togglePause()">PAUSE TIMER</button>
      <div class="quick-add">
        <button onclick="addTime(5)">+5 min</button>
        <button onclick="addTime(10)">+10 min</button>
        <button onclick="addTime(30)">+30 min</button>
      </div>
      <button class="danger" style="margin-top:10px" onclick="if(confirm('DELETE EVERYTHING?'))resetAll()">RESET ALL</button>
    </div>

    <div class="card">
      <h2>Event Rewards (seconds)</h2>
      <div class="slider-grid"><label>Tier 1</label><input type="range" min="0" max="600" value="60" id="t1" oninput="saveReward('t1',this.value);v('t1',this.value)"><span class="value" id="t1v">60</span></div>
      <div class="slider-grid"><label>Tier 2</label><input type="range" min="0" max="600" value="120" id="t2" oninput="saveReward('t2',this.value);v('t2',this.value)"><span class="value" id="t2v">120</span></div>
      <div class="slider-grid"><label>Tier 3</label><input type="range" min="0" max="600" value="300" id="t3" oninput="saveReward('t3',this.value);v('t3',this.value)"><span class="value" id="t3v">300</span></div>
      <div class="slider-grid"><label>Gift Sub</label><input type="range" min="0" max="600" value="60" id="gift" oninput="saveReward('gift',this.value);v('gift',this.value)"><span class="value" id="giftv">60</span></div>
      <div class="slider-grid"><label>Donation/$1</label><input type="range" min="0" max="300" value="60" id="don" oninput="saveReward('don',this.value);v('don',this.value)"><span class="value" id="donv">60</span></div>
      <div class="slider-grid"><label>Bits/100</label><input type="range" min="0" max="300" value="30" id="bits" oninput="saveReward('bits',this.value);v('bits',this.value)"><span class="value" id="bitsv">30</span></div>
    </div>

    <div class="card">
      <h2>Manual Add</h2>
      <input type="number" step="0.01" id="addMoney" placeholder="Donation amount ($)">
      <input type="number" id="addMinutes" placeholder="Extra minutes">
      <button onclick="addMoneyAndTime()">Add $ + Time</button>
      <button onclick="addMoneyOnly()">Add $ Only (+1min/$)</button>
      <button style="margin-top:8px" onclick="addTimeOnly()">Add Time Only</button>
    </div>

    <div class="card">
      <h2>Appearance & Customization</h2>
      <input id="streamerName" placeholder="Streamer name">
      <button onclick="updateName()">Update Name</button>
      <label>Goal Scale: <strong><span id="scaleValue">100</span>%</strong></label>
      <input type="range" min="50" max="200" value="100" id="goalScale" oninput="document.getElementById('scaleValue').textContent=this.value;saveScale(this.value)">
    </div>
  </div>
</div>

<script>
const PATH='donothon-ultimate-2025-x7k9p2m4q8z3v6n1';
const PASSWORDS=['Rin125','125','Rinmod125'];
firebase.initializeApp({apiKey:"AIzaSyBFQFPo85fIpaHWl3Kr0PZ6WIm5B6WVusA",authDomain:"ceres-donothon-timer.firebaseapp.com",databaseURL:"https://ceres-donothon-timer-default-rtdb.firebaseio.com",projectId:"ceres-donothon-timer"});
const ref=firebase.database().ref(PATH);

// Login
document.getElementById('pw').addEventListener('keypress', e=>{ if(e.key==='Enter') login(); });
function login(){ 
  if(PASSWORDS.includes(document.getElementById('pw').value.trim())){
    document.getElementById('loginScreen').style.display='none';
    document.getElementById('main').style.display='block';
    init();
  } else alert('Wrong password');
}

// Init + live preview
function init(){
  setInterval(updateLive,500);
  ref.on('value', s => {
    const d = s.val() || {};
    document.getElementById('status').textContent = d.paused ? 'PAUSED' : (d.endTime ? 'LIVE' : 'STOPPED');
    document.getElementById('pauseBtn').textContent = d.paused ? 'RESUME' : 'PAUSE';
  });
  ref.child('settings/streamerName').on('value', s => document.getElementById('liveName').textContent = s.val() || 'Ceres');
  ref.child('socketToken').on('value', s => {
    document.getElementById('socketToken').value = s.val() || '';
    document.getElementById('socketStatus').textContent = s.val() ? 'Connected!' : 'Not connected';
  });
  ref.child('config/eventRewards').on('value', loadRewards);
  ref.child('theme/goalScale').on('value', s=>{
    const val=(s.val()||1)*100;
    document.getElementById('goalScale').value=val;
    document.getElementById('scaleValue').textContent=Math.round(val);
  });
}

function updateLive(){
  ref.once('value').then(s=>{
    const d=s.val()||{};
    let left=0;
    if(d.endTime||d.pausedAt){
      const bonus=(d.bonusSeconds||0)*1000;
      const base=d.paused&&d.pausedAt?d.pausedAt:(d.endTime||0);
      left=Math.max(0,Math.floor((base+bonus-Date.now())/1000));
    }
    const h=('0'+Math.floor(left/3600)).slice(-2);
    const m=('0'+Math.floor(left%3600/60)).slice(-2);
    const sec=('0'+left%60).slice(-2);
    document.getElementById('liveTimer').textContent=`${h}:${m}:${sec}`;
    document.getElementById('liveRaised').textContent=(d.totalEarned||0).toFixed(2);
    document.getElementById('liveSubs').textContent=d.subsCount||0;
    document.getElementById('liveBits').textContent=d.bitsCount||0;
  });
}

// Pause / Resume
function togglePause(){
  ref.once('value').then(snap=>{
    const d=snap.val()||{};
    const now=Date.now();
    const bonus=(d.bonusSeconds||0)*1000;
    if(d.paused){
      // RESUME
      const frozenMoment=d.pausedAt;
      ref.update({ endTime:frozenMoment, paused:false, pausedAt:null });
    } else {
      // PAUSE
      const currentEnd=d.endTime||(now+10800000);
      ref.update({ paused:true, pausedAt:currentEnd, endTime:null });
    }
  });
}

function startTimer(){
  const h=+document.getElementById('startHours').value||0;
  const m=+document.getElementById('startMinutes').value||0;
  const duration=(h*3600+m*60)*1000;
  ref.update({ endTime:Date.now()+duration, bonusSeconds:0, paused:false, pausedAt:null });
}

function addTime(minutes){ ref.child('bonusSeconds').transaction(v=>(v||0)+minutes*60); }
function addMoneyAndTime(){
  const money=+document.getElementById('addMoney').value||0;
  const mins=+document.getElementById('addMinutes').value||0;
  if(money||mins) ref.transaction(x=>{ x.totalEarned=(x.totalEarned||0)+money; x.bonusSeconds=(x.bonusSeconds||0)+mins*60; return x; });
  document.getElementById('addMoney').value=''; document.getElementById('addMinutes').value='';
}
function addMoneyOnly(){ const money=+document.getElementById('addMoney').value||0; if(money) ref.transaction(x=>{ x.totalEarned=(x.totalEarned||0)+money; x.bonusSeconds=(x.bonusSeconds||0)+money*60; return x; }); document.getElementById('addMoney').value=''; }
function addTimeOnly(){ const mins=+document.getElementById('addMinutes').value||0; if(mins) ref.child('bonusSeconds').transaction(v=>(v||0)+mins*60); document.getElementById('addMinutes').value=''; }

function saveSocketToken(){ const token=document.getElementById('socketToken').value.trim(); ref.child('socketToken').set(token||null); }
function saveReward(key,val){ ref.child('config/eventRewards/'+key).set(+val); }
function v(id,val){ document.getElementById(id+'v').textContent=val; }
function loadRewards(s){ const r=s.val()||{}; ['t1','t2','t3','gift','don','bits'].forEach(k=>{ if(r[k]!==undefined){ document.getElementById(k).value=r[k]; document.getElementById(k+'v').textContent=r[k]; } }); }
function saveScale(val){ ref.child('theme/goalScale').set(val/100); }
function updateName(){ ref.child('settings/streamerName').set(document.getElementById('streamerName').value.trim()||'Ceres'); }
function resetAll(){ if(confirm('This deletes EVERYTHING!')) ref.set({}); }
</script>
</body>
</html>
