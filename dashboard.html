<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>Ceres Donothon Dashboard</title>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-database-compat.js"></script>
<style>
  body{background:#0f0f1e;color:#fff;font-family:Arial;padding:20px}
  input,button{padding:12px;margin:8px;font-size:18px;border-radius:8px}
  button{background:#9146FF;color:white;border:none;cursor:pointer}
  .section{background:#16213e;padding:25px;margin:20px 0;border-radius:15px}
  .goal-item{background:#223;padding:15px;margin:10px 0;border-radius:10px;border-left:5px solid #9146FF}
  .goal-item input{width:120px;margin-right:10px}
  .current-goal{font-size:28px;margin:15px 0;padding:15px;background:#112;border-radius:10px}
</style></head><body>

<div class="section"><h1>CERES DONOTHON 2025</h1>
  <div id="login">Password: <input type="password" id="pw"><button onclick="login()">Enter</button></div>
</div>

<div id="main" style="display:none;">
  <div class="section" style="font-size:60px;text-align:center" id="liveTimer">00:00:00</div>
  <div class="section" style="font-size:32px;text-align:center">
    Raised: $<span id="liveRaised">0.00</span> | Subs: <span id="liveSubs">0</span>
  </div>

  <div class="section">
    <button onclick="ref.update({startTime:Date.now(),paused:false})" style="font-size:30px;padding:20px;background:green">START</button>
    <button onclick="togglePause()" id="pauseBtn">PAUSE</button>
    <button onclick="if(confirm('RESET EVERYTHING?'))ref.set({startTime:null,bonusSeconds:0,totalEarned:0,subsCount:0,highestSub:'None',config:{milestones:{}}})" style="background:red">RESET ALL</button>
  </div>

  <div class="section">
    <h2>Manual Controls</h2>
    Minutes: <input id="min" type="number"><button onclick="addTime()">Add</button><br>
    Money $: <input id="money" type="number"><button onclick="addMoney()">Add $ + Time</button>
  </div>

  <div class="section">
    <h2>Currently Visible on Stream (3 goals)</h2>
    <div id="currentGoals"></div>
  </div>

  <div class="section">
    <h2>All Goals (edit / delete)</h2>
    <div id="goalList"></div>
    <div style="margin-top:20px">
      Amount: <input id="newAmt" type="number" placeholder="5000">
      Description: <input id="newDesc" placeholder="Sing Baby Shark" style="width:350px">
      <button onclick="addMilestone()">Add Goal</button>
    </div>
  </div>

  <div class="section">
    <h2>Colors</h2>
    Accent <input type="color" id="ac" value="#9146FF">
    Background <input type="color" id="bg" value="#000000"> Opacity <input type="range" id="op" min="0" max="100" value="80">
    Text <input type="color" id="txt" value="#ffffff">
    Gradient 1 <input type="color" id="g1" value="#9146FF">
    Gradient 2 <input type="color" id="g2" value="#00ffcc">
    Checkmark <input type="color" id="chk" value="#00ff99">
    <button onclick="saveColors()">SAVE COLORS</button>
  </div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBFQFPo85fIpaHWl3Kr0PZ6WIm5B6WVusA",
  authDomain: "ceres-donothon-timer.firebaseapp.com",
  databaseURL: "https://ceres-donothon-timer-default-rtdb.firebaseio.com",
  projectId: "ceres-donothon-timer",
  storageBucket: "ceres-donothon-timer.firebasestorage.app",
  messagingSenderId: "62539165670",
  appId: "1:62539165670:web:170c8110449deba628b027",
  measurementId: "G-9F66NMVB2J"
};
const PATH = 'donothon-ultimate-2025-x7k9p2m4q8z3v6n1';
const PASSWORDS = ['Rin125', '125', 'Rinmod125'];

firebase.initializeApp(firebaseConfig);
const ref = firebase.database().ref(PATH);

function login(){if(PASSWORDS.includes(document.getElementById('pw').value)){document.getElementById('main').style.display='block';document.getElementById('login').style.display='none';loadAll();}}
function loadAll(){
  setInterval(updateLive,1000);
  ref.child('theme').on('value',s=>{const t=s.val()||{};['ac','bg','txt','g1','g2','chk'].forEach(id=>t[id]&&document.getElementById(id).setAttribute('value',t[id]));t.bgOpacity&&document.getElementById('op').value=t.bgOpacity;});
  ref.child('config/milestones').on('value',renderAllGoals);
  ref.on('value',renderCurrentGoals);
}
function updateLive(){
  ref.once('value').then(s=>{const d=s.val()||{};let sec=d.paused?(d.pausedAtSeconds||0):(d.startTime?Math.floor((Date.now()-d.startTime)/1000)+(d.bonusSeconds||0):0);
    const h=String(Math.floor(sec/3600)).padStart(2,'0'),m=String(Math.floor(sec%3600/60)).padStart(2,'0'),ss=String(sec%60).padStart(2,'0');
    document.getElementById('liveTimer').textContent=(d.paused?'[PAUSED] ':'')+`${h}:${m}:${ss}`;
    document.getElementById('liveRaised').textContent=(d.totalEarned||0).toFixed(2);
    document.getElementById('liveSubs').textContent=d.subsCount||0;
    document.getElementById('pauseBtn').textContent=d.paused?'RESUME':'PAUSE';
  });
}
function renderCurrentGoals(s){
  const d=s.val()||{}, earned=d.totalEarned||0, goals=Object.values(d.config?.milestones||{}).sort((a,b)=>a.amount-b.amount);
  const active=goals.filter(g=>earned < g.amount+5000).slice(0,3);
  const div=document.getElementById('currentGoals'); div.innerHTML='';
  active.forEach(g=>{const complete=earned>=g.amount;
    div.innerHTML+=`<div class="current-goal ${complete?'complete':''}"><b>$${g.amount.toLocaleString()}</b> → ${g.description} ${complete?'CHECKMARK':''}</div>`;
  });
}
function renderAllGoals(s){
  const goals=s.val()||{}; const list=document.getElementById('goalList'); list.innerHTML='';
  Object.entries(goals).sort((a,b)=>a[1].amount-b[1].amount).forEach(([id,g])=>{
    const div=document.createElement('div'); div.className='goal-item';
    div.innerHTML=`<input value="${g.amount}" onchange="ref.child('config/milestones/${id}/amount').set(parseFloat(this.value)||0)"> → 
      <input value="${g.description}" style="width:400px" onchange="ref.child('config/milestones/${id}/description').set(this.value)">
      <button onclick="ref.child('config/milestones/${id}').remove()" style="background:#c11">Delete</button>`;
    list.appendChild(div);
  });
}
function addTime(){const m=parseFloat(document.getElementById('min').value)||0;if(m)ref.child('bonusSeconds').transaction(v=>(v||0)+m*60);}
function addMoney(){const a=parseFloat(document.getElementById('money').value)||0;if(a)ref.transaction(d=>{d.totalEarned+=a;d.bonusSeconds+=(d.config?.timePerDollar||60)*a;return d;});}
function addMilestone(){const amt=parseFloat(document.getElementById('newAmt').value);const desc=document.getElementById('newDesc').value.trim();if(amt&&desc)ref.child('config/milestones').push({amount:amt,description:desc});document.getElementById('newAmt').value='';document.getElementById('newDesc').value='';}
function saveColors(){
  const op=document.getElementById('op').value/100; const bg=document.getElementById('bg').value;
  ref.child('theme').set({
    accent:document.getElementById('ac').value,
    bg:`rgba(${parseInt(bg.slice(1,3),16)},${parseInt(bg.slice(3,5),16)},${parseInt(bg.slice(5,7),16)},${op})`,
    bgColor:bg, bgOpacity:document.getElementById('op').value,
    text:document.getElementById('txt').value,
    grad1:document.getElementById('g1').value,
    grad2:document.getElementById('g2').value,
    check:document.getElementById('chk').value
  });
}
function togglePause(){
  ref.once('value').then(s=>{const d=s.val();
    if(d.paused){
      const elapsed=d.pausedAtSeconds||0;
      ref.update({startTime:Date.now()-elapsed*1000,paused:false,pausedAtSeconds:null});
    }else{
      const elapsed=Math.floor((Date.now()-d.startTime)/1000)+(d.bonusSeconds||0);
      ref.update({paused:true,pausedAtSeconds:elapsed});
    }
  });
}
</script>
</body></html>
