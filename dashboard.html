<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Donothon Control Panel</title>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-database-compat.js"></script>
<style>
  body{background:#0a0a1f;color:#fff;font-family:'Segoe UI',sans-serif;margin:0;padding:20px}
  .card{background:linear-gradient(135deg,#16162a,#0f0f22);padding:28px;border-radius:18px;margin:20px 0;
        box-shadow:0 10px 40px rgba(0,0,0,0.7);border:1px solid #333}
  h1,h2{margin:0 0 20px;color:#a855f7;font-weight:700}
  input,button,select{padding:14px;margin:8px 0;font-size:16px;border-radius:12px;border:none;width:100%;box-sizing:border-box;background:#222;color:#fff}
  button{background:#a855f7;color:white;cursor:pointer;font-weight:bold;transition:.3s}
  button:hover{transform:translateY(-4px);box-shadow:0 12px 25px rgba(168,85,247,0.5)}
  .btn-success{background:#00c853}
  .btn-danger{background:#e91e63}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(350px,1fr));gap:25px}
  .goal-item{background:#1a1a2e;padding:16px;margin:12px 0;border-radius:12px;border-left:6px solid #a855f7}
  .manual-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:15px;align-items:end}
</style>
</head>
<body>

<div id="login" style="max-width:500px;margin:100px auto;text-align:center">
  <h1>DONOTHON CONTROL PANEL</h1>
  <input type="password" id="pw" placeholder="Password">
  <button onclick="login()">Enter</button>
</div>

<div id="main" style="display:none;max-width:1400px;margin:0 auto">
  <div class="card" style="text-align:center">
    <h1>Donothon Timer by <span id="liveName">Ceres</span></h1>
    <h2 style="font-size:60px;color:#00ffaa" id="liveTimer">03:00:00</h2>
    <p style="font-size:26px">Raised: $<span id="liveRaised">0.00</span> • Subs: <span id="liveSubs">0</span> • Bits: <span id="liveBits">0</span></p>
  </div>

  <div class="grid">
    <!-- Timer Control -->
    <div class="card">
      <h2>Timer Control</h2>
      <button class="btn-success" style="padding:20px;font-size:20px" onclick="startTimer()">START 3-HOUR TIMER</button>
      <button id="pauseBtn" style="margin:15px 0;padding:16px" onclick="togglePause()">PAUSE TIMER</button>
      <button class="btn-danger" onclick="if(confirm('Reset ALL data?'))resetAll()">RESET EVERYTHING</button>
    </div>

    <!-- Manual Add Money & Time -->
    <div class="card">
      <h2>Manual Add</h2>
      <div class="manual-grid">
        <div>
          <input type="number" id="addMoney" placeholder="Add $ (e.g. 50)" step="0.01">
        </div>
        <div>
          <input type="number" id="addMinutes" placeholder="Add Minutes (e.g. 10)">
        </div>
        <div>
          <button onclick="addMoneyAndTime()" style="padding:18px;font-size:18px">ADD BOTH</button>
        </div>
      </div>
      <button onclick="addMoneyOnly()" style="margin-top:10px">Add Money Only (+1 min per $)</button>
      <button onclick="addTimeOnly()" style="margin-top:8px">Add Time Only</button>
    </div>

    <!-- Streamer Name -->
    <div class="card">
      <h2>Streamer Name</h2>
      <input id="streamerName" placeholder="Your name on the widget">
      <button onclick="ref.child('settings/streamerName').set(document.getElementById('streamerName').value.trim()||'Ceres')">Update Name</button>
    </div>

    <!-- Token -->
    <div class="card">
      <h2>Stream Token</h2>
      <input id="tokenInput" placeholder="Streamlabs / StreamElements token">
      <button onclick="saveToken()">Save Token</button>
      <p>Status: <span id="tokenStatus">Not connected</span></p>
    </div>
  </div>

  <!-- Goals -->
  <div class="card">
    <h2>Incentives & Goals</h2>
    <div id="goalList"></div>
    <hr style="border:1px dashed #444;margin:20px 0">
    <input placeholder="$ Amount" id="newAmt" style="width:30%">
    <input placeholder="Goal description" id="newDesc" style="width:65%">
    <button onclick="addGoal()">Add Goal</button>
  </div>

  <!-- Colors & Fonts (simplified) -->
  <div class="grid">
    <div class="card">
      <h2>Colors</h2>
      Accent <input type="color" id="ac" value="#a855f7" onchange="save('accent',this.value)"><br>
      Background <input type="color" id="bg" value="#08081c" onchange="updateBG()"><br>
      Opacity <input type="range" min="70" max="100" value="96" id="op" onchange="updateBG()"><br>
      Text <input type="color" id="txt" value="#ffffff" onchange="save('text',this.value)"><br>
      Gradient <input type="color" id="g1" value="#a855f7" onchange="save('grad1',this.value)"> → <input type="color" id="g2" value="#00e5ff" onchange="save('grad2',this.value)"><br>
      Checkmark <input type="color" id="chk" value="#00ffaa" onchange="save('check',this.value)"><br>
      <button onclick="saveColors()">SAVE ALL COLORS</button>
    </div>
  </div>
</div>

<script>
const config = {apiKey:"AIzaSyBFQFPo85fIpaHWl3Kr0PZ6WIm5B6WVusA",authDomain:"ceres-donothon-timer.firebaseapp.com",databaseURL:"https://ceres-donothon-timer-default-rtdb.firebaseio.com",projectId:"ceres-donothon-timer"};
const PATH = 'donothon-ultimate-2025-x7k9p2m4q8z3v6n1';
const PASSWORDS = ['Rin125','125','Rinmod125'];
firebase.initializeApp(config);
const ref = firebase.database().ref(PATH);

function login(){
  if(PASSWORDS.includes(document.getElementById('pw').value.trim())){
    document.getElementById('main').style.display='block';
    document.getElementById('login').style.display='none';
    init();
  }else{alert('Wrong password');}
}
document.getElementById('pw').addEventListener('keypress',e=>e.key==='Enter'&&login());

function init(){
  setInterval(updateLive,500);
  ref.child('settings').on('value',s=>{const st=s.val()||{};document.getElementById('liveName').textContent=st.streamerName||'Ceres';document.getElementById('tokenStatus').textContent=st.token?'Connected':'Not connected';});
  ref.child('config/milestones').on('value',renderGoals);
}

// Live timer update
function updateLive(){
  ref.once('value').then(s=>{
    const d=s.val()||{};
    const left = d.endTime ? Math.max(0,Math.floor((d.endTime + (d.bonusSeconds||0)*1000 - Date.now())/1000)) : 0;
    const h=String(Math.floor(left/3600)).padStart(2,'0');
    const m=String(Math.floor(left%3600/60)).padStart(2,'0');
    const sec=String(left%60).padStart(2,'0');
    document.getElementById('liveTimer').textContent=`${h}:${m}:${sec}`;
    document.getElementById('liveRaised').textContent=(d.totalEarned||0).toFixed(2);
    document.getElementById('liveSubs').textContent=d.subsCount||0;
    document.getElementById('liveBits').textContent=d.bitsCount||0;
    document.getElementById('pauseBtn').textContent = d.paused ? 'RESUME TIMER' : 'PAUSE TIMER';
    document.getElementById('pauseBtn').className = d.paused ? 'btn-success' : '';
  });
}

// Manual Add Functions
function addMoneyAndTime(){
  const money = parseFloat(document.getElementById('addMoney').value) || 0;
  const mins = parseFloat(document.getElementById('addMinutes').value) || 0;
  if(money || mins){
    ref.transaction(d => {
      d.totalEarned = (d.totalEarned||0) + money;
      d.bonusSeconds = (d.bonusSeconds||0) + mins*60;
      return d;
    });
    document.getElementById('addMoney').value = '';
    document.getElementById('addMinutes').value = '';
  }
}
function addMoneyOnly(){
  const money = parseFloat(document.getElementById('addMoney').value) || 0;
  if(money){
    ref.transaction(d => {
      d.totalEarned = (d.totalEarned||0) + money;
      d.bonusSeconds = (d.bonusSeconds||0) + money*60;
      return d;
    });
    document.getElementById('addMoney').value = '';
  }
}
function addTimeOnly(){
  const mins = parseFloat(document.getElementById('addMinutes').value) || 0;
  if(mins){
    ref.child('bonusSeconds').transaction(v => (v||0) + mins*60);
    document.getElementById('addMinutes').value = '';
  }
}

// Timer controls
function startTimer(){ref.update({endTime:Date.now()+3*60*60*1000,bonusSeconds:0,paused:false,pausedAt:null});}
function togglePause(){
  ref.once('value').then(s=>{
    const d=s.val()||{};
    if(d.paused){
      const remaining = Math.floor((d.pausedAt + (d.bonusSeconds||0)*1000 - Date.now())/1000);
      ref.update({endTime:Date.now()+remaining*1000,paused:false,pausedAt:null});
    }else{
      ref.update({paused:true,pausedAt:d.endTime||Date.now()});
    }
  });
}
function saveToken(){ref.child('settings/token').set(document.getElementById('tokenInput').value.trim());}
function resetAll(){if(confirm('NUKE EVERYTHING?'))ref.set({config:{milestones:{}},settings:{},theme:{},totalEarned:0,bonusSeconds:0,endTime:null,paused:false});}

// Goals
function renderGoals(s){
  const goals = s.val()||{};
  const list = document.getElementById('goalList'); list.innerHTML='';
  Object.entries(goals).sort((a,b)=>a[1].amount-b[1].amount).forEach(([id,g])=>{
    const div = document.createElement('div'); div.className='goal-item';
    div.innerHTML = `$${g.amount} → <input value="${g.description}" onchange="ref.child('config/milestones/${id}/description').set(this.value)"> <button style="float:right;background:#e91e63" onclick="ref.child('config/milestones/${id}').remove()">Delete</button>`;
    list.appendChild(div);
  });
}
function addGoal(){
  const amt = +document.getElementById('newAmt').value;
  const desc = document.getElementById('newDesc').value.trim();
  if(amt && desc) ref.child('config/milestones').push({amount:amt,description:desc});
  document.getElementById('newAmt').value=''; document.getElementById('newDesc').value='';
}

function save(k,v){ref.child('theme').child(k).set(v);}
function updateBG(){
  const hex = document.getElementById('bg').value;
  const r = parseInt(hex.slice(1,3),16), g = parseInt(hex.slice(3,5),16), b = parseInt(hex.slice(5,7),16);
  const op = document.getElementById('op').value/100;
  save('bg',`rgba(${r},${g},${b},${op})`);
}
function saveColors(){
  save('accent',document.getElementById('ac').value);
  save('text',document.getElementById('txt').value);
  save('grad1',document.getElementById('g1').value);
  save('grad2',document.getElementById('g2').value);
  save('check',document.getElementById('chk').value);
  updateBG();
}
</script>
</body>
</html>
