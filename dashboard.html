<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ceres Donothon — Ultimate Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-database-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/reconnecting-websocket/dist/reconnecting-websocket.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@600&display=swap" rel="stylesheet">
<style>
:root{
  --border:#a855f7;--bg:#0d0b1c;--text:#e2e8f0;
  --grad1:#a855f7;--grad2:#00e5ff;--glow:#00ffaa;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;display:flex;justify-content:center;padding:20px;}
#loginScreen{background:linear-gradient(135deg,#14132b,#0f0f22);width:400px;padding:50px 40px;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,.6);text-align:center;border:1px solid var(--border);}
#loginScreen h1{font-size:36px;margin-bottom:10px;background:linear-gradient(90deg,#a855f7,#00e5ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
input,button{width:100%;padding:14px 16px;border-radius:12px;border:none;font-size:16px;margin:8px 0;background:#1e1c38;color:var(--text);}
button{background:var(--grad1);color:white;font-weight:600;cursor:pointer;transition:.2s;}
button:hover{background:var(--grad2);}
button.success{background:#00c853;}
button.danger{background:var(--glow);}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(360px,1fr));gap:24px;}
.card{background:#14132b;border-radius:16px;padding:28px;border:1px solid var(--border);box-shadow:0 8px 32px rgba(0,0,0,.4);}
.card h2{font-size:24px;color:var(--grad1);margin-bottom:20px;}
.slider-grid{display:grid;grid-template-columns:1fr auto;gap:12px;align-items:center;margin:10px 0;}
.value{min-width:60px;text-align:right;padding:6px 10px;background:#1e1c38;border-radius:8px;font-weight:600;}
.goal-item{background:#1e1c38;padding:14px;border-radius:12px;margin:10px 0;display:flex;gap:12px;align-items:center;border-left:4px solid var(--grad1);}
.goal-item input{background:transparent;border:none;color:var(--text);font-size:16px;flex:1;}
</style>
</head>
<body>

<div id="loginScreen">
  <h1>CERES DONOTHON</h1>
  <input type="password" id="pw" placeholder="Password" autofocus>
  <button onclick="login()">UNLOCK</button>
</div>

<div id="main" style="display:none;max-width:1400px;width:100%;padding:20px">
  <h1 style="text-align:center;background:linear-gradient(90deg,#a855f7,#00e5ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:20px">
    Ceres Donothon — Dashboard
  </h1>

  <div class="grid">

    <!-- TIMER CARD -->
    <div class="card">
      <h2>Timer Control</h2>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <input type="number" id="startHours" value="3" min="0">
        <input type="number" id="startMinutes" value="0" min="0" max="59">
      </div>
      <button class="success" style="margin-top:10px" onclick="startTimer()">START TIMER</button>
      <button id="pauseBtn" style="margin-top:10px" onclick="togglePause()">PAUSE TIMER</button>
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-top:10px">
        <button onclick="addTime(5)">+5 min</button>
        <button onclick="addTime(10)">+10 min</button>
        <button onclick="addTime(30)">+30 min</button>
      </div>
    </div>

    <!-- EVENTS CARD -->
    <div class="card">
      <h2>Event Rewards</h2>
      <div class="slider-grid"><label>Donation/$1</label><input type="range" min="0" max="300" value="60" id="don" oninput="saveReward('don',this.value);v('don',this.value)"><span class="value" id="donv">60</span></div>
      <div class="slider-grid"><label>Sub</label><input type="range" min="0" max="600" value="60" id="subs" oninput="saveReward('subs',this.value);v('subs',this.value)"><span class="value" id="subsv">60</span></div>
      <div class="slider-grid"><label>Bits/100</label><input type="range" min="0" max="300" value="30" id="bits" oninput="saveReward('bits',this.value);v('bits',this.value)"><span class="value" id="bitsv">30</span></div>
      <div class="slider-grid"><label>Gift Sub</label><input type="range" min="0" max="600" value="60" id="gift" oninput="saveReward('gift',this.value);v('gift',this.value)"><span class="value" id="giftv">60</span></div>
    </div>

    <!-- MILESTONES CARD -->
    <div class="card">
      <h2>Milestones</h2>
      <div id="goalList"></div>
      <div style="display:flex;gap:12px;margin-top:10px">
        <input type="number" step="0.01" id="newGoalAmount" placeholder="$ Amount" style="width:120px">
        <input type="text" id="newGoalDesc" placeholder="Description" style="flex:1">
        <button class="success" onclick="addGoal()">+ ADD</button>
      </div>
    </div>

    <!-- COLORS -->
    <div class="card">
      <h2>Colors / Appearance</h2>
      <div class="slider-grid"><label>Border/Glow</label><input type="color" value="#a855f7" onchange="saveColor('border',this.value)"></div>
      <div class="slider-grid"><label>Background</label><input type="color" value="#0d0b1c" onchange="saveColor('bg',this.value)"></div>
      <div class="slider-grid"><label>Text</label><input type="color" value="#e2e8f0" onchange="saveColor('text',this.value)"></div>
      <div class="slider-grid"><label>Gradient Start</label><input type="color" value="#a855f7" onchange="saveColor('grad1',this.value)"></div>
      <div class="slider-grid"><label>Gradient End</label><input type="color" value="#00e5ff" onchange="saveColor('grad2',this.value)"></div>
      <div class="slider-grid"><label>Glow</label><input type="color" value="#00ffaa" onchange="saveColor('glow',this.value)"></div>
    </div>
  </div>
</div>

<script>
const PATH='donothon-ultimate-2025-x7k9p2m4q8z3v6n1';
const PASSWORDS=['Rin125','125','Rinmod125'];
firebase.initializeApp({
  apiKey:"AIzaSyBFQFPo85fIpaHWl3Kr0PZ6WIm5B6WVusA",
  authDomain:"ceres-donothon-timer.firebaseapp.com",
  databaseURL:"https://ceres-donothon-timer-default-rtdb.firebaseio.com",
  projectId:"ceres-donothon-timer"
});
const ref = firebase.database().ref(PATH);

// LOGIN
function login(){
  if(PASSWORDS.includes(document.getElementById('pw').value.trim())){
    document.getElementById('loginScreen').style.display='none';
    document.getElementById('main').style.display='block';
    init();
  } else alert('Wrong password');
}

// INIT
function init(){
  ref.on('value', snap => {
    const d = snap.val()||{};
    document.getElementById('pauseBtn').textContent = d.paused ? 'RESUME' : 'PAUSE';
    renderGoals(d.config?.milestones||{});
  });

  ref.child('config/eventRewards').on('value', loadRewards);
  ref.child('theme').on('value', loadColors);
}

// TIMER FUNCTIONS
function startTimer(){
  const h = +document.getElementById('startHours').value||0;
  const m = +document.getElementById('startMinutes').value||0;
  ref.update({endTime:Date.now()+(h*3600+m*60)*1000,paused:false,pausedAt:null,bonusSeconds:0});
}
function togglePause(){
  ref.once('value').then(snap=>{
    const d=snap.val()||{};
    if(d.paused){
      ref.update({endTime:d.pausedAt,paused:false,pausedAt:null});
    } else {
      ref.update({paused:true,pausedAt:d.endTime,endTime:null});
    }
  });
}
function addTime(m){ ref.child('bonusSeconds').transaction(v=>(v||0)+m*60); }

// COLORS
function saveColor(k,v){ ref.child('theme/'+k).set(v); }
function loadColors(s){ 
  const t = s.val()||{};
  Object.keys(t).forEach(k=>{
    document.querySelectorAll('input[type=color]').forEach(input=>{
      if(input.getAttribute('onchange').includes(k)) input.value=t[k];
    });
  });
}

// EVENT REWARDS
function saveReward(k,v){ ref.child('config/eventRewards/'+k).set(+v); }
function v(id,vv){ document.getElementById(id+(id==='subs'?'v':'v')).textContent=vv; }
function loadRewards(s){
  const r=s.val()||{};
  ['don','subs','bits','gift'].forEach(k=>{
    if(r[k]!==undefined) { document.getElementById(k).value=r[k]; document.getElementById(k+(k==='subs'?'v':'v')).textContent=r[k]; }
  });
}

// MILESTONES
function addGoal(){
  const amt=+document.getElementById('newGoalAmount').value;
  const desc=document.getElementById('newGoalDesc').value.trim();
  if(!amt||!desc)return alert('Fill both!');
  ref.child('config/milestones').push({amount:amt,description:desc});
  document.getElementById('newGoalAmount').value=''; document.getElementById('newGoalDesc').value='';
}
function renderGoals(goalsObj){
  const list=document.getElementById('goalList');
  const goals=Object.entries(goalsObj||{}).sort((a,b)=>a[1].amount-b[1].amount);
  list.innerHTML='';
  goals.forEach(([id,g])=>{
    const div=document.createElement('div'); div.className='goal-item';
    div.innerHTML=`<span>$${g.amount.toFixed(2)}</span>
      <input value="${g.description}" onblur="ref.child('config/milestones/${id}/description').set(this.value)">
      <button onclick="ref.child('config/milestones/${id}').remove()">Delete</button>`;
    list.appendChild(div);
  });
}
</script>
</body>
</html>
