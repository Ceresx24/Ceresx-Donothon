<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ceres Donothon Dashboard — Full Custom</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-database-compat.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@600&display=swap" rel="stylesheet">
<style>
:root{--bg:#0d0b1c;--card:#14132b;--accent:#a855f7;--accent2:#c17aff;--text:#e2e8f0;--success:#00ffaa;--danger:#ff3366;--border:#2d2a57}
*{box-sizing:border-box;margin:0;padding:0}body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;display:flex;align-items:center;justify-content:center;background-image:radial-gradient(circle at top right,#1a1650 0%,transparent 50%)}
#loginScreen{background:linear-gradient(135deg,#14132b,#0f0f22);width:420px;padding:50px 40px;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,.6);text-align:center;border:1px solid var(--border)}
#loginScreen h1{font-size:36px;margin-bottom:10px;background:linear-gradient(90deg,#a855f7,#00e5ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
input,button{width:100%;padding:14px 16px;border-radius:12px;border:none;font-size:16px;margin:8px 0;background:#1e1c38;color:var(--text)}
button{background:var(--accent);color:white;font-weight:600;cursor:pointer;transition:.2s}
button:hover{background:#c17aff;transform:translateY(-2px)}
button.success{background:#00c853} button.danger{background:var(--danger)}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(360px,1fr));gap:24px}
.card{background:var(--card);border-radius:16px;padding:28px;border:1px solid var(--border);box-shadow:0 8px 32px rgba(0,0,0,.4)}
.card h2{font-size:24px;color:var(--accent);margin-bottom:20px}
.color-row{display:grid;grid-template-columns:1fr auto;gap:12px;align-items:center;margin:10px 0}
.live-preview{background:linear-gradient(135deg,#14132b,#0f0f22);padding:32px;border-radius:20px;text-align:center;border:1px solid var(--border);margin-bottom:30px}
#liveTimer{font-family:'JetBrains Mono',monospace;font-size:92px;background:linear-gradient(90deg,#00ffaa,#00e5ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.goal-item{background:#1e1c38;padding:14px;border-radius:12px;margin:10px 0;display:flex;gap:12px;align-items:center;border-left:4px solid var(--accent)}
.goal-item input{background:transparent;border:none;color:var(--text);font-size:16px;flex:1}
select{background:#1e1c38;color:var(--text);border-radius:12px;padding:8px;font-size:16px}
</style>
</head>
<body>

<div id="loginScreen">
  <h1>CERES DONOTHON</h1><p>Control Panel</p>
  <input type="password" id="pw" placeholder="Password" autofocus>
  <button onclick="login()">UNLOCK</button>
</div>

<div id="main" style="display:none;max-width:1400px;width:100%;padding:20px">
  <h1 style="text-align:center;background:linear-gradient(90deg,#a855f7,#00e5ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:20px">Ceres Donothon — FULL CUSTOM</h1>

  <div class="live-preview">
    <h2 style="color:#fff">Donothon by <span id="liveName">Ceres</span></h2>
    <div id="liveTimer">03:00:00</div>
    <div style="font-size:28px">Raised: $<span id="liveRaised">0.00</span></div>
    <div class="status" id="status">STOPPED</div>
  </div>

  <div class="grid">
    <div class="card">
      <h2>Colors & Appearance</h2>
      <div class="color-row"><label>Border/Glow</label><input type="color" value="#a855f7" onchange="saveColor('a',this.value)"></div>
      <div class="color-row"><label>Background</label><input type="color" value="#08081c" onchange="saveColor('b',this.value+'d0')"></div>
      <div class="color-row"><label>Text</label><input type="color" value="#ffffff" onchange="saveColor('t',this.value)"></div>
      <div class="color-row"><label>Bar Start</label><input type="color" value="#a855f7" onchange="saveColor('g1',this.value)"></div>
      <div class="color-row"><label>Bar End</label><input type="color" value="#00e5ff" onchange="saveColor('g2',this.value)"></div>
      <div class="color-row"><label>Goal Hit</label><input type="color" value="#00ffaa" onchange="saveColor('gh',this.value)"></div>
      <div class="color-row"><label>Timer Glow</label><input type="color" value="#00ffaa" onchange="saveColor('th',this.value)"></div>
      <div class="color-row"><label>Timer Font</label>
        <select onchange="saveFont(this.value)">
          <option value='JetBrains Mono'>JetBrains Mono</option>
          <option value='Orbitron'>Orbitron</option>
          <option value='Exo 2'>Exo 2</option>
          <option value='Arial'>Arial</option>
          <option value='Verdana'>Verdana</option>
        </select>
      </div>
      <div class="color-row"><label>Animation</label>
        <select onchange="saveAnimation(this.value)">
          <option value='none'>None</option>
          <option value='pulse'>Pulse</option>
          <option value='scale'>Scale</option>
          <option value='glow'>Glow</option>
          <option value='bounce'>Bounce</option>
        </select>
      </div>
      <button style="margin-top:15px" onclick="resetColors()">Reset Colors</button>
    </div>

    <div class="card">
      <h2>Timer Control</h2>
      <input type="number" id="startHours" value="3" min="0" style="width:48%;display:inline-block"> <input type="number" id="startMinutes" value="0" min="0" max="59" style="width:48%;display:inline-block">
      <button class="success" style="padding:18px;font-size:20px;margin:10px 0" onclick="startTimer()">START TIMER</button>
      <button id="pauseBtn" style="padding:16px;font-size:18px" onclick="togglePause()">PAUSE TIMER</button>
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-top:10px">
        <button onclick="addTime(5)">+5 min</button>
        <button onclick="addTime(10)">+10 min</button>
        <button onclick="addTime(30)">+30 min</button>
      </div>
    </div>

    <div class="card">
      <h2>Event Rewards (seconds)</h2>
      <div class="color-row"><label>Tier 1</label><input type="range" min="0" max="600" value="60" id="t1" oninput="saveReward('t1',this.value);v('t1',this.value)"><span id="t1v">60</span></div>
      <div class="color-row"><label>Tier 2</label><input type="range" min="0" max="600" value="120" id="t2" oninput="saveReward('t2',this.value);v('t2',this.value)"><span id="t2v">120</span></div>
      <div class="color-row"><label>Tier 3</label><input type="range" min="0" max="600" value="300" id="t3" oninput="saveReward('t3',this.value);v('t3',this.value)"><span id="t3v">300</span></div>
      <div class="color-row"><label>Gift Sub</label><input type="range" min="0" max="600" value="60" id="gift" oninput="saveReward('gift',this.value);v('gift',this.value)"><span id="giftv">60</span></div>
      <div class="color-row"><label>Donation/$1</label><input type="range" min="0" max="300" value="60" id="don" oninput="saveReward('don',this.value);v('don',this.value)"><span id="donv">60</span></div>
      <div class="color-row"><label>Bits/100</label><input type="range" min="0" max="300" value="30" id="bits" oninput="saveReward('bits',this.value);v('bits',this.value)"><span id="bitsv">30</span></div>
    </div>

    <div class="card">
      <h2>Socket Token</h2>
      <input type="text" id="socketToken" placeholder="Streamlabs / SE token">
      <button class="success" onclick="saveSocketToken()">SAVE & CONNECT</button>
      <div style="margin-top:8px;color:var(--success);font-weight:600" id="socketStatus">Not connected</div>
    </div>

  </div>

  <div class="card" style="margin-top:30px">
    <h2>Milestones</h2>
    <div id="goalList">Loading...</div>
    <div style="display:flex;gap:12px;margin-top:20px">
      <input type="number" step="0.01" id="newGoalAmount" placeholder="$ Amount" style="width:160px">
      <input type="text" id="newGoalDesc" placeholder="Description" style="flex:1">
      <input type="text" id="newGoalSound" placeholder="Sound URL" style="flex:1">
      <button class="success" onclick="addGoal()">+ ADD GOAL</button>
    </div>
  </div>

<script>
const PATH='donothon-ultimate-2025-x7k9p2m4q8z3v6n1';
const PASSWORDS=['Rin125','125','Rinmod125'];
firebase.initializeApp({apiKey:"AIzaSyBFQFPo85fIpaHWl3Kr0PZ6WIm5B6WVusA",authDomain:"ceres-donothon-timer.firebaseapp.com",databaseURL:"https://ceres-donothon-timer-default-rtdb.firebaseio.com",projectId:"ceres-donothon-timer"});
const ref = firebase.database().ref(PATH);

document.getElementById('pw').addEventListener('keypress', e => e.key==='Enter' && login());
function login() {
  if (PASSWORDS.includes(document.getElementById('pw').value.trim())) {
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('main').style.display = 'block';
    init();
  } else alert('Wrong password');
}

function init() {
  setInterval(updateLive, 500);
  ref.on('value', s => {
    const d = s.val() || {};
    document.getElementById('status').textContent = d.paused ? 'PAUSED' : (d.endTime ? 'LIVE' : 'STOPPED');
    document.getElementById('pauseBtn').textContent = d.paused ? 'RESUME' : 'PAUSE';
  });
  ref.child('settings/streamerName').on('value', s => document.getElementById('liveName').textContent = s.val() || 'Ceres');
  ref.child('socketToken').on('value', s => {
    document.getElementById('socketToken').value = s.val() || '';
    document.getElementById('socketStatus').textContent = s.val() ? 'Connected!' : 'Not connected';
  });
  ref.child('config/eventRewards').on('value', loadRewards);
  ref.child('theme').on('value', loadColors);
  ref.child('config/milestones').on('value', renderGoals);
}

function updateLive() {
  ref.once('value').then(s => {
    const d = s.val() || {};
    let left = 0;
    if (d.endTime || d.pausedAt) {
      const bonus = (d.bonusSeconds || 0) * 1000;
      const base = d.paused && d.pausedAt ? d.pausedAt : (d.endTime || 0);
      left = Math.max(0, Math.floor((base + bonus - Date.now()) / 1000));
    }
    const h = ('0'+Math.floor(left/3600)).slice(-2);
    const m = ('0'+Math.floor(left%3600/60)).slice(-2);
    const sec = ('0'+left%60).slice(-2);
    document.getElementById('liveTimer').textContent = `${h}:${m}:${sec}`;
    document.getElementById('liveRaised').textContent = (d.totalEarned || 0).toFixed(2);
  });
}

function togglePause() {
  ref.once('value').then(snap => {
    const d = snap.val() || {};
    const now = Date.now();
    const bonus = (d.bonusSeconds || 0) * 1000;
    if (d.paused) {
      const frozen = d.pausedAt;
      ref.update({ endTime: frozen + bonus, paused: false, pausedAt: null });
    } else {
      const currentEnd = d.endTime || (now + 10800000);
      const frozen = currentEnd + bonus;
      ref.update({ paused: true, pausedAt: frozen, endTime: null });
    }
  });
}

function startTimer() {
  const h = +document.getElementById('startHours').value || 0;
  const m = +document.getElementById('startMinutes').value || 0;
  ref.update({ endTime: Date.now() + (h*3600 + m*60)*1000, bonusSeconds: 0, paused: false, pausedAt: null });
}
function addTime(m) { ref.child('bonusSeconds').transaction(v => (v || 0) + m*60); }

function saveColor(k,v) { ref.child('theme/'+k).set(v); }
function resetColors() { if(confirm('Reset colors?')) ref.child('theme').remove(); }
function loadColors(s) {
  const t = s.val() || {};
  document.querySelectorAll('input[type=color]').forEach(input => {
    const key = input.getAttribute('onchange').match(/'(\w+)'/)[1];
    if (t[key]) input.value = t[key].replace(/d0$/,'').replace(/[^0-9a-f]/gi,'');
  });
}

function saveReward(k,v) { ref.child('config/eventRewards/'+k).set(+v); }
function v(id,val) { document.getElementById(id+'v').textContent = val; }
function loadRewards(s) {
  const r = s.val() || {};
  ['t1','t2','t3','gift','don','bits'].forEach(k => {
    if (r[k] !== undefined) { document.getElementById(k).value = r[k]; document.getElementById(k+'v').textContent = r[k]; }
  });
}

function saveSocketToken() { ref.child('socketToken').set(document.getElementById('socketToken').value.trim() || null); }

function addGoal() {
  const amt = +document.getElementById('newGoalAmount').value;
  const desc = document.getElementById('newGoalDesc').value.trim();
  const snd = document.getElementById('newGoalSound').value.trim();
  if (!amt || !desc) return alert('Fill all fields!');
