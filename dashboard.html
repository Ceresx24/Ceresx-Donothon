<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ceres Donothon Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-database-compat.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@700&family=Orbitron:wght@900&display=swap" rel="stylesheet">
<style>
:root {--border:#a855f7; --bg:#0d0b1c; --card:#14132b; --accent:#a855f7; --accent2:#c17aff; --text:#e2e8f0; --success:#00ffaa; --danger:#ff3366; --timerGlow:#00ffaa; --goalHit:#00ffaa; --scale:1;}
*{box-sizing:border-box;margin:0;padding:0;font-family:'Exo 2',sans-serif;}
body{background:var(--bg);color:var(--text);min-height:100vh;display:flex;justify-content:center;align-items:flex-start;padding:2em;}
#loginScreen{background:var(--card);padding:3em;border-radius:2em;text-align:center;max-width:400px;width:100%;border:1px solid var(--border);}
#loginScreen input, #loginScreen button{width:100%;padding:1em;margin:.5em 0;border-radius:1em;border:none;font-size:1em;}
#loginScreen button{background:var(--accent);color:white;cursor:pointer;transition:.2s;}#loginScreen button:hover{background:var(--accent2);}
#main{display:none;max-width:1400px;width:100%;}
h1{font-size:2em;text-align:center;margin-bottom:1em;color:var(--accent);}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:1.5em;}
.card{background:var(--card);border-radius:1.5em;padding:1.5em;border:1px solid var(--border);box-shadow:0 0 2em rgba(0,0,0,.3);}
.card h2{color:var(--accent);margin-bottom:.5em;}
input, button, select{font-size:1em;}
button.success{background:#00c853;color:white;}button.danger{background:var(--danger);}
.color-row{display:grid;grid-template-columns:1fr auto;gap:.5em;align-items:center;margin:.5em 0;}
.slider-row{display:flex;align-items:center;gap:.5em;margin:.5em 0;}
.value{min-width:2em;text-align:right;}
#pauseBtn.paused{background:#f55;}
.goal-item{display:flex;gap:.5em;align-items:center;margin:.5em 0;padding:.5em;border-left:.3em solid var(--accent);}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginScreen">
  <h1>Ceres Donothon</h1>
  <input type="password" id="pw" placeholder="Password" autofocus>
  <button onclick="login()">Unlock</button>
</div>

<!-- DASHBOARD -->
<div id="main">
  <h1>Dashboard</h1>
  <div class="grid">
    <div class="card">
      <h2>Timer Control</h2>
      <input type="number" id="startHours" value="3" min="0"> h
      <input type="number" id="startMinutes" value="0" min="0" max="59"> m<br>
      <button class="success" onclick="startTimer()">Start Timer</button>
      <button id="pauseBtn" onclick="togglePause()">Pause</button>
      <div style="display:flex;gap:.5em;margin-top:.5em">
        <button onclick="addTime(5)">+5 min</button>
        <button onclick="addTime(10)">+10 min</button>
        <button onclick="addTime(30)">+30 min</button>
      </div>
    </div>

    <div class="card">
      <h2>Colors / Theme</h2>
      <div class="color-row"><label>Border / Glow</label><input type="color" onchange="saveColor('border',this.value)"></div>
      <div class="color-row"><label>Background</label><input type="color" onchange="saveColor('bg',this.value)"></div>
      <div class="color-row"><label>Text</label><input type="color" onchange="saveColor('text',this.value)"></div>
      <div class="color-row"><label>Accent 1</label><input type="color" onchange="saveColor('accent',this.value)"></div>
      <div class="color-row"><label>Accent 2</label><input type="color" onchange="saveColor('accent2',this.value)"></div>
      <div class="color-row"><label>Timer Glow</label><input type="color" onchange="saveColor('timerGlow',this.value)"></div>
      <div class="color-row"><label>Overlay Scale</label><input type="range" min="50" max="200" value="100" oninput="saveScale(this.value)"></div>
    </div>

    <div class="card">
      <h2>Socket Token</h2>
      <input type="text" id="socketToken" placeholder="Streamlabs / SE">
      <button class="success" onclick="saveSocketToken()">Save & Connect</button>
      <div id="socketStatus">Not connected</div>
    </div>

    <div class="card">
      <h2>Milestones</h2>
      <div id="goalList"></div>
      <div style="display:flex;gap:.5em;margin-top:.5em">
        <input type="number" id="newGoalAmount" placeholder="$ Amount">
        <input type="text" id="newGoalDesc" placeholder="Description">
        <button class="success" onclick="addGoal()">Add</button>
      </div>
    </div>
  </div>
</div>

<script>
const PATH='donothon-ultimate-2025-x7k9p2m4q8z3v6n1';
const PASSWORDS=['Rin125','125','Rinmod125'];
firebase.initializeApp({apiKey:"AIzaSyBFQFPo85fIpaHWl3Kr0PZ6WIm5B6WVusA",authDomain:"ceres-donothon-timer.firebaseapp.com",databaseURL:"https://ceres-donothon-timer-default-rtdb.firebaseio.com",projectId:"ceres-donothon-timer"});
const ref = firebase.database().ref(PATH);

// LOGIN
function login(){
  if(PASSWORDS.includes(document.getElementById('pw').value.trim())){
    document.getElementById('loginScreen').style.display='none';
    document.getElementById('main').style.display='block';
    init();
  } else alert('Wrong password');
}
document.getElementById('pw').addEventListener('keypress', e=>{if(e.key==='Enter') login();});

// INIT
function init(){
  ref.on('value', snap=>{
    const d = snap.val()||{};
    document.getElementById('pauseBtn').textContent=d.paused?'Resume':'Pause';
    renderGoals(d.config?.milestones||{});
    loadColors(d.theme||{});
    document.getElementById('socketToken').value=d.socketToken||'';
    document.getElementById('socketStatus').textContent=d.socketToken?'Connected':'Not connected';
  });
}

// TIMER
function startTimer(){
  const h=+document.getElementById('startHours').value||0;
  const m=+document.getElementById('startMinutes').value||0;
  ref.update({endTime:Date.now()+(h*3600+m*60)*1000,paused:false,pausedAt:null,bonusSeconds:0});
}
function togglePause(){
  ref.once('value').then(s=>{
    const d = s.val()||{};
    if(d.paused){
      const frozen=d.pausedAt||Date.now();
      ref.update({endTime:frozen+(d.bonusSeconds||0)*1000,paused:false,pausedAt:null});
    }else{
      const frozen=d.endTime||Date.now()+10800000;
      ref.update({paused:true,pausedAt:frozen,endTime:null});
    }
  });
}
function addTime(m){ref.child('bonusSeconds').transaction(v=>(v||0)+m*60);}

// COLORS
function saveColor(k,v){ref.child('theme/'+k).set(v);}
function saveScale(v){ref.child('theme/scale').set(v/100);}
function loadColors(theme){
  Object.entries(theme).forEach(([k,v])=>document.documentElement.style.setProperty('--'+k,v));
}

// SOCKET
function saveSocketToken(){ref.child('socketToken').set(document.getElementById('socketToken').value.trim()||null);}

// MILESTONES
function addGoal(){
  const amt=+document.getElementById('newGoalAmount').value;
  const desc=document.getElementById('newGoalDesc').value.trim();
  if(!amt||!desc)return alert('Fill both!');
  ref.child('config/milestones').push({amount:amt,description:desc});
  document.getElementById('newGoalAmount').value='';
  document.getElementById('newGoalDesc').value='';
}
function renderGoals(goals){
  const container=document.getElementById('goalList');
  container.innerHTML='';
  Object.entries(goals).sort((a,b)=>a[1].amount-b[1].amount).forEach(([id,g])=>{
    const div=document.createElement('div');
    div.className='goal-item';
    div.innerHTML=`<span>$${g.amount}</span>
      <input value="${g.description}" onblur="ref.child('config/milestones/${id}/description').set(this.value)">
      <button onclick="ref.child('config/milestones/${id}').remove()">Delete</button>`;
    container.appendChild(div);
  });
}
</script>
</body>
</html>
