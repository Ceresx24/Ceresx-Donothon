<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Donothon Control Panel</title>
  <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-database-compat.js"></script>
  <style>
    body{background:#0a0a1a;color:#fff;font-family:'Segoe UI',sans-serif;margin:0;padding:20px}
    .card{background:#161628;padding:25px;border-radius:16px;margin:20px 0;box-shadow:0 8px 32px rgba(0,0,0,0.6)}
    h1,h2{margin:0 0 20px;color:#a855f7;font-weight:600}
    input,button,select{padding:14px;margin:8px 0;font-size:16px;border-radius:10px;border:none;width:100%;box-sizing:border-box}
    button{background:#a855f7;color:white;cursor:pointer;font-weight:bold;transition:0.3s}
    button:hover{transform:translateY(-3px);box-shadow:0 10px 20px rgba(168,85,247,0.4)}
    .btn-danger{background:#e91e63}
    .btn-success{background:#00c853}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:20px}
    @media(max-width:900px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>

<div id="login" style="max-width:500px;margin:100px auto;text-align:center">
  <h1>DONOTHON CONTROL PANEL</h1>
  <input type="password" id="pw" placeholder="Enter password" style="margin:20px 0">
  <button onclick="login()">Enter</button>
</div>

<div id="main" style="display:none;max-width:1200px;margin:0 auto">

  <div class="card">
    <h1>Donothon Timer by <span id="liveName">Ceres</span></h1>
    <h2 style="font-size:48px;color:#00ffaa" id="liveTimer">03:00:00</h2>
    <p style="font-size:24px">Raised: $<span id="liveRaised">0.00</span> • Subs: <span id="liveSubs">0</span> • Bits: <span id="liveBits">0</span></p>
  </div>

  <div class="grid">
    <div class="card">
      <h2>Start & Control</h2>
      <button class="btn-success" style="padding:20px;font-size:20px" onclick="startTimer()">START 3-HOUR TIMER</button>
      <button id="pauseBtn" style="margin-top:15px" onclick="togglePause()">PAUSE TIMER</button>
      <button class="btn-danger" onclick="if(confirm('Reset everything?'))resetAll()">RESET ALL DATA</button>
    </div>

    <div class="card">
      <h2>Your Name on Widget</h2>
      <input id="streamerName" placeholder="e.g. Ceres">
      <button onclick="ref.child('settings/streamerName').set(document.getElementById('streamerName').value)">Update Name</button>
    </div>
  </div>

  <div class="card">
    <h2>Stream Token (Streamlabs / StreamElements)</h2>
    <input id="tokenInput" placeholder="Paste your JWT or socket token here" style="font-family:monospace">
    <button onclick="saveToken()">Save & Connect Token</button>
    <p style="font-size:14px;margin-top:10px">Current: <span id="currentToken">Not connected</span></p>
  </div>

  <div class="card">
    <h2>Goals & Customization</h2>
    <p>Go to your original goal/theme dashboard if you need advanced editing.</p>
  </div>
</div>

<script>
const config = {apiKey:"AIzaSyBFQFPo85fIpaHWl3Kr0PZ6WIm5B6WVusA",authDomain:"ceres-donothon-timer.firebaseapp.com",databaseURL:"https://ceres-donothon-timer-default-rtdb.firebaseio.com",projectId:"ceres-donothon-timer"};
const PATH = 'donothon-ultimate-2025-x7k9p2m4q8z3v6n1';
const PASSWORDS = ['Rin125','125','Rinmod125'];
firebase.initializeApp(config);
const ref = firebase.database().ref(PATH);

function login(){if(PASSWORDS.includes(document.getElementById('pw').value.trim())){document.getElementById('main').style.display='block';document.getElementById('login').style.display='none';init();}else{alert('Wrong password');}}
document.getElementById('pw').addEventListener('keypress',e=>e.key==='Enter'&&login());

function init(){
  setInterval(updateTimer,500);
  ref.child('settings').on('value',s=>{const st=s.val()||{};document.getElementById('liveName').textContent=st.streamerName||'Ceres';document.getElementById('currentToken').textContent=st.token?'Connected':'Not connected';});
}
function updateTimer(){
  ref.once('value').then(s=>{
    const d=s.val()||{};
    const left = d.endTime ? Math.max(0,Math.floor((d.endTime + (d.bonusSeconds||0)*1000 - Date.now())/1000)) : 0;
    const h=String(Math.floor(left/3600)).padStart(2,'0');
    const m=String(Math.floor(left%3600/60)).padStart(2,'0');
    const sec=String(left%60).padStart(2,'0');
    document.getElementById('liveTimer').textContent=`${h}:${m}:${sec}`;
    document.getElementById('liveRaised').textContent=(d.totalEarned||0).toFixed(2);
    document.getElementById('liveSubs').textContent=d.subsCount||0;
    document.getElementById('liveBits').textContent=d.bitsCount||0;
    document.getElementById('pauseBtn').textContent = d.paused ? 'RESUME TIMER' : 'PAUSE TIMER';
    document.getElementById('pauseBtn').className = d.paused ? 'btn-success' : '';
  });
}
function startTimer(){ref.update({endTime:Date.now()+3*60*60*1000,bonusSeconds:0,paused:false,pausedAt:null});}
function togglePause(){
  ref.once('value').then(s=>{
    const d=s.val()||{};
    if(d.paused){
      const remaining = Math.floor((d.pausedAt + (d.bonusSeconds||0)*1000 - Date.now())/1000);
      ref.update({endTime:Date.now()+remaining*1000,paused:false,pausedAt:null});
    }else{
      ref.update({paused:true,pausedAt:d.endTime||Date.now()});
    }
  });
}
function saveToken(){
  const token = document.getElementById('tokenInput').value.trim();
  if(token) ref.child('settings/token').set(token);
}
function resetAll(){ref.set({endTime:null,bonusSeconds:0,totalEarned:0,subsCount:0,bitsCount:0,config:{milestones:{}},settings:{}});}
</script>
</body>
</html>
