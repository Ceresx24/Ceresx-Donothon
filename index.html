<!DOCTYPE html>
.checkmark{position:absolute;right:4rem;top:50%;transform:translateY(-50%) scale(0) rotate(-45deg);font-size:18rem;color:var(--goal-complete);opacity:0}
.goal.complete .checkmark{animation:check 1.2s .6s forwards}
@keyframes check{0%{opacity:0;transform:translateY(-50%) scale(.3) rotate(-45deg)}70%{opacity:1;transform:translateY(-50%) scale(1.3) rotate(10deg)}100%{opacity:1;transform:translateY(-50%) scale(1) rotate(0)}}
.footer{font:600 5rem 'Exo 2',sans-serif;color:#ccc;margin-top:3rem}
.hide{display:none}
</style>
</head>
<body>
<div class="overlay">
<div id="timer">03:00:00</div>
<div class="stats">Raised: $<span id="raised">0.00</span> • Goal: $<span id="totalGoal">10,000</span></div>
<div class="stats" id="subsLine">Subs: <span id="subs">0</span> • Bits: <span id="bits">0</span></div>
<div class="goals" id="goals"></div>
<div class="footer" id="footerName">Donothon Timer by Ceres</div>
</div>
<audio id="sound" preload="auto"></audio>
<script>
const PATH='donothon-ultimate-2025-x7k9p2m4q8z3v6n1';
firebase.initializeApp({apiKey:"AIzaSyBFQFPo85fIpaHWl3Kr0PZ6WIm5B6WVusA",authDomain:"ceres-donothon-timer.firebaseapp.com",databaseURL:"https://ceres-donothon-timer-default-rtdb.firebaseio.com",projectId:"ceres-donothon-timer"});
const db=firebase.database().ref(PATH);
const sound=document.getElementById('sound');
let celebrated=new Set(JSON.parse(localStorage.getItem('donothon_celebrated_2025')||'[]'));
let cache={};


function update(){
const d=cache;
const cfg=d.config||{};
const earned=Number(d.totalEarned||0);
const goals=Object.values(cfg.milestones||{}).sort((a,b)=>a.amount-b.amount);
let left=0;
if(d.endTime||d.pausedAt){
const bonus=(d.bonusSeconds||0)*1000;
const baseTime=d.paused&&d.pausedAt?d.pausedAt:d.endTime;
left=Math.max(0,(baseTime+bonus-Date.now())/1000);
}
const h=('0'+Math.floor(left/3600)).slice(-2);
const m=('0'+Math.floor(left%3600/60)).slice(-2);
const s=('0'+Math.floor(left%60)).slice(-2);
const timer=document.getElementById('timer');
timer.textContent=`${h}:${m}:${s}`;
timer.className=(d.bonusSeconds>0?'bonus':'')+(d.paused?' paused':'')+(d.justHit?' hit':'');
document.getElementById('raised').textContent=earned.toFixed(2);
document.getElementById('totalGoal').textContent=(cfg.goal||10000).toLocaleString();
document.getElementById('subs').textContent=d.subsCount||0;
document.getElementById('bits').textContent=d.bitsCount||0;
const container=document.getElementById('goals');
container.innerHTML='';
goals.filter(g=>earned<g.amount+5000).slice(0,3).forEach(g=>{
const complete=earned>=g.amount;
const pct=complete?100:(earned/g.amount)*100;
const div=document.createElement('div');
div.className=`goal${complete?' complete':''}`;
if(complete&&!celebrated.has(g.amount)){
celebrated.add(g.amount);
localStorage.setItem('donothon_celebrated_2025',JSON.stringify([...celebrated]));
div.classList.add('hit');
timer.classList.add('hit');
setTimeout(()=>{div.classList.remove('hit');timer.classList.remove('hit');},5000);
if(d.theme?.confetti!==false) confetti({particleCount:1400,spread:180,origin:{y:0.55}});
sound.currentTime=0;sound.play().catch(()=>{});
db.child('justHit').remove();
}
div.innerHTML=`<div class="goal-title">$${g.amount.toLocaleString()} → ${g.description||'Goal'}</div><div class="bar-wrap"><div class="bar" style="width:${pct}%"></div></div>${complete?'<div class="checkmark">Checkmark</div>':''}`;
container.appendChild(div);
});
}
db.on('value',snap=>{cache=snap.val()||{};update();});
db.child('theme').on('value',s=>{
const t=s.val()||{};
Object.entries(t).forEach(([k,v])=>v!==null&&document.documentElement.style.setProperty('--'+k,v));
sound.src=t.sound||"https://static.wikia.nocookie.net/runescape/images/4/4f/Level_up.ogg/revision/latest";
sound.volume=Math.max(0,Math.min(1,(t.soundVolume||100)/100));
document.getElementById('subsLine').classList.toggle('hide',!!t.hideSubs);
document.getElementById('totalGoal').parentElement.classList.toggle('hide',!!t.hideGoal);
document.getElementById('footerName').classList.toggle('hide',!!t.hideFooter);
});
db.child('settings/streamerName').on('value',s=>document.getElementById('footerName').textContent=s.val()||'Donothon Timer by Ceres');
setInterval(update,50);
</script>
</body>
</html>
