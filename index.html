<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ceres Donothon Overlay</title>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-database-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@700&family=Orbitron:wght@900&display=swap" rel="stylesheet">
<style>
html, body {
  margin: 0; padding: 0;
  height: 100vh; width: 100vw;
  background: transparent;
  overflow: hidden;
  display: flex; justify-content: center; align-items: center;
  font-family: 'Orbitron', sans-serif;
}
:root {
  --a: #a855f7; --b: rgba(8,8,28,.96); --t: #fff;
  --g1: #a855f7; --g2: #00e5ff; --c: #00ffaa;
  --s: 1; --gh: #00ffaa; --th: #00ffaa;
}
.overlay-box {
  background: var(--b);
  padding: 3em;
  border-radius: 3em;
  border: .35em solid var(--a);
  box-shadow: 0 0 6em var(--a), inset 0 0 4em #a855f730;
  backdrop-filter: blur(1em);
  text-align: center;
  transform: scale(var(--s));
}
#timer {
  font: 900 8em Orbitron,sans-serif;
  color: var(--t);
  text-shadow: 0 0 .5em #000;
  margin: 0 0 1em;
  line-height: 1;
}
#raised {
  font: 600 2.5em 'Exo 2',sans-serif;
  margin-bottom: .5em;
}
.milestones { margin-top: 2em; }
.milestone {
  background: #1e1e46c0;
  border-radius: 2em;
  padding: 1em;
  margin-bottom: 1em;
  border: .3em solid #333;
  position: relative;
  overflow: hidden;
}
.milestone.completed {
  border-color: var(--c);
  background: #004030c0;
  box-shadow: 0 0 1.5em var(--gh);
  animation: milestoneFlash .6s 1;
}
.milestone .bar {
  height: 2em;
  border-radius: 1em;
  background: linear-gradient(90deg, var(--g1), var(--g2));
  width: 0%;
  transition: width 1s ease;
}
@keyframes milestoneFlash {
  0%,100% { box-shadow:0 0 1.5em var(--gh); }
  50% { box-shadow:0 0 3em var(--gh), 0 0 6em var(--gh); background:#008040; }
}
</style>
</head>
<body>
<div class="overlay-box">
  <div id="timer">03:00:00</div>
  <div id="raised">Raised: $0.00</div>
  <div class="milestones" id="milestoneContainer"></div>
</div>

<script>
const PATH = 'donothon-ultimate-2025-x7k9p2m4q8z3v6n1';
firebase.initializeApp({
  apiKey:"AIzaSyBFQFPo85fIpaHWl3Kr0PZ6WIm5B6WVusA",
  authDomain:"ceres-donothon-timer.firebaseapp.com",
  databaseURL:"https://ceres-donothon-timer-default-rtdb.firebaseio.com",
  projectId:"ceres-donothon-timer"
});
const db = firebase.database().ref(PATH);
let earned = 0;
let doneMilestones = new Set();

function updateOverlay() {
  db.once('value').then(snap => {
    const data = snap.val() || {};
    earned = data.totalEarned || 0;
    document.getElementById('raised').textContent = `Raised: $${earned.toFixed(2)}`;

    // Timer
    let left = 0;
    if (data.endTime || data.pausedAt) {
      const bonus = (data.bonusSeconds||0)*1000;
      const base = data.paused && data.pausedAt ? data.pausedAt : (data.endTime || Date.now()+10800000);
      left = Math.max(0, Math.floor((base + bonus - Date.now())/1000));
    }
    const h = ('0'+Math.floor(left/3600)).slice(-2);
    const m = ('0'+Math.floor(left%3600/60)).slice(-2);
    const s = ('0'+left%60).slice(-2);
    document.getElementById('timer').textContent = `${h}:${m}:${s}`;

    // Milestones
    const container = document.getElementById('milestoneContainer');
    container.innerHTML = '';
    const goals = Object.values(data.config?.milestones||{}).sort((a,b)=>a.amount-b.amount);
    goals.forEach(g => {
      const pct = Math.min(100,(earned/g.amount)*100);
      const div = document.createElement('div');
      div.className = 'milestone';
      if (earned >= g.amount) { div.classList.add('completed'); if(!doneMilestones.has(g.amount)){doneMilestones.add(g.amount); confetti({particleCount:500,spread:180,origin:{y:.5}}); } }
      div.innerHTML = `<div>${g.description || 'Goal'}: $${g.amount}</div>
                       <div class="bar" style="width:${pct}%;"></div>`;
      container.appendChild(div);
    });
  });
}

setInterval(updateOverlay, 500);
updateOverlay();
</script>
</body>
</html>
