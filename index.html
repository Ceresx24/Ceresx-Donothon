<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Donothon Public Widget</title>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-database-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
<style>
  body { margin:0; background:transparent; font-family:'Impact',sans-serif; color:var(--text); text-align:center; }
  .container { padding:40px; border-radius:25px; display:inline-block; background:var(--bg); border:6px solid var(--accent); box-shadow:0 0 50px var(--accent); }
  #timer { font-size:110px; letter-spacing:8px; text-shadow:0 0 25px black; }
  .goal-row { background:#222; border-radius:18px; padding:20px; margin:25px 0; border:4px solid #444; transition:all 1s; }
  .goal-row.complete { border-color:#00ff99; background:rgba(0,80,0,0.8); }
  .goal-row.hiding { opacity:0; transform:translateY(-40px); height:0; padding:0; margin:0; border:none; }
  .bar-fill { height:60px; background:linear-gradient(90deg,var(--grad1),var(--grad2)); border-radius:15px; transition:width 1.5s ease; }
  .checkmark { position:absolute; right:30px; top:50%; transform:translateY(-50%); font-size:100px; color:#00ff99; opacity:0; }
  .checkmark.show { opacity:1; }
</style>
</head>
<body>
<div class="container">
  <div id="timer">00:00:00</div>
  <div style="font-size:60px;">Raised: $<span id="raised">0.00</span> / $<span id="goal">10,000</span></div>
  <div id="goals"></div>
</div>

<script>
// ←←← CHANGE ONLY THESE TWO LINES ←←←
const firebaseConfig = { /* PASTE YOUR FIREBASE CONFIG HERE */ };
const PATH = 'donothon-ultimate-2025-x7k9p2m4q8z3v6n1'; // your secret path
// ←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←

firebase.initializeApp(firebaseConfig);
const ref = firebase.database().ref(PATH);

ref.child('theme').on('value', s => {
  const t = s.val()||{};
  Object.entries({
    '--accent': t.accent||'#9146FF',
    '--bg': t.bg||'rgba(0,0,0,0.8)',
    '--text': t.text||'white',
    '--grad1': t.grad1||'#9146FF',
    '--grad2': t.grad2||'#00ffcc',
  }).forEach(([k,v])=>document.documentElement.style.setProperty(k,v));
});

let earned = 0;
ref.on('value', s => {
  const d = s.val()||{};
  const c = d.config||{};
  earned = d.totalEarned||0;

  // Timer
  const secs = d.paused ? (d.pausedAtSeconds||0) : (d.startTime ? Math.floor((Date.now()-d.startTime)/1000)+(d.bonusSeconds||0) : 0);
  const h = String(Math.floor(secs/3600)).padStart(2,'0');
  const m = String(Math.floor((secs%3600/60)).padStart(2,'0');
  const s = String(secs%60).padStart(2,'0');
  document.getElementById('timer').textContent = d.paused ? `[PAUSED] ${h}:${m}:${s}` : `${h}:${m}:${s}`;
  document.getElementById('raised').textContent = earned.toFixed(2);
  document.getElementById('goal').textContent = c.goal||10000;

  // Goals (3 at a time + auto-hide)
  const goalsDiv = document.getElementById('goals');
  goalsDiv.innerHTML = '';
  if (!c.milestones) return;

  const list = Object.values(c.milestones).sort((a,b)=>a.amount-b.amount);
  const active = list.slice(Math.max(0, list.findIndex(g=>earned <<g.amount)-2), list.findIndex(g=>earned<g.amount)+3).filter(Boolean);
  active.slice(0,3).forEach(g => {
    const complete = earned >= g.amount;
    const row = document.createElement('div');
    row.className = `goal-row ${complete?'complete':''}`;
    row.innerHTML = `<div style="font-size:48px;margin-bottom:15px;">$${g.amount.toLocaleString()} → ${g.description}</div>
      <div style="position:relative;"><div class="bar-fill" style="width:${Math.min(100,(earned/g.amount)*100)}%"></div>
      <div div class="checkmark ${complete?'show':''}">CHECKMARK</div></div>`;
    if (complete) setTimeout(()=>row.classList.add('hiding'), 20000);
    goalsDiv.appendChild(row);
    if (complete && earned >= g.amount && earned < g.amount + 10) confetti({particleCount:300,spread:120});
  });
});
</script>
</body>
</html>
