<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ceres Donothon Overlay</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-database-compat.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@600&display=swap" rel="stylesheet">
<style>
:root{--bg:#0d0b1c;--card:#14132b;--accent:#a855f7;--accent2:#c17aff;--text:#e2e8f0;--success:#00ffaa;--danger:#ff3366;--border:#2d2a57}
*{box-sizing:border-box;margin:0;padding:0}body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center}
#overlayContainer{width:100%;max-width:1400px;padding:20px;text-align:center}
#liveTimer{font-family:'JetBrains Mono',monospace;font-size:92px;background:linear-gradient(90deg,#00ffaa,#00e5ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.milestone-bar{background:#1e1c38;border-radius:12px;margin:10px 0;position:relative;height:28px;overflow:hidden}
.milestone-fill{height:100%;border-radius:12px;background:linear-gradient(90deg,var(--accent),var(--accent2));transition:width 0.5s ease}
.milestone-label{position:absolute;left:10px;top:0;height:100%;display:flex;align-items:center;color:var(--text);font-weight:600}
</style>
</head>
<body>
<div id="overlayContainer">
  <h2 id="streamerName">Ceres Donothon</h2>
  <div id="liveTimer">03:00:00</div>
  <div id="raisedAmount">Raised: $0.00</div>
  <div id="milestones"></div>
</div>
<script>
const PATH='donothon-ultimate-2025-x7k9p2m4q8z3v6n1';
firebase.initializeApp({apiKey:"AIzaSyBFQFPo85fIpaHWl3Kr0PZ6WIm5B6WVusA",authDomain:"ceres-donothon-timer.firebaseapp.com",databaseURL:"https://ceres-donothon-timer-default-rtdb.firebaseio.com",projectId:"ceres-donothon-timer"});
const ref=firebase.database().ref(PATH);

ref.child('settings/streamerName').on('value',s=>document.getElementById('streamerName').textContent=s.val()||'Ceres');
ref.on('value',updateOverlay);
ref.child('config/milestones').on('value',renderMilestones);

function updateOverlay(s){
  const d=s.val()||{};
  let left=0;
  if(d.endTime||d.pausedAt){
    const bonus=(d.bonusSeconds||0)*1000;
    const base=d.paused&&d.pausedAt?d.pausedAt:(d.endTime||0);
    left=Math.max(0,Math.floor((base+bonus-Date.now())/1000));
  }
  const h=('0'+Math.floor(left/3600)).slice(-2);
  const m=('0'+Math.floor(left%3600/60)).slice(-2);
  const sec=('0'+left%60).slice(-2);
  document.getElementById('liveTimer').textContent=`${h}:${m}:${sec}`;
  document.getElementById('raisedAmount').textContent=`Raised: $${(d.totalEarned||0).toFixed(2)}`;
  updateMilestoneFill(d.totalEarned||0);
}

let milestoneData={};
function renderMilestones(s){
  milestoneData=s.val()||{};
  const container=document.getElementById('milestones');
  container.innerHTML='';
  Object.entries(milestoneData).sort((a,b)=>a[1].amount-b[1].amount).forEach(([id,g])=>{
    const bar=document.createElement('div');
    bar.className='milestone-bar';
    bar.id='milestone-'+id;
    const fill=document.createElement('div');
    fill.className='milestone-fill';
    fill.style.width='0%';
    const label=document.createElement('div');
    label.className='milestone-label';
    label.textContent=`$${g.amount.toFixed(2)} - ${g.description}`;
    bar.appendChild(fill);
    bar.appendChild(label);
    container.appendChild(bar);
  });
}

function updateMilestoneFill(total){
  Object.entries(milestoneData).forEach(([id,g])=>{
    const bar=document.getElementById('milestone-'+id);
    if(bar){
      const fill=bar.querySelector('.milestone-fill');
      const pct=Math.min(100,(total/g.amount)*100);
      fill.style.width=pct+'%';
    }
  });
}
</script>
</body>
</html>
