<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Donothon Timer – OBS Safe</title>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-database-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@700&family=Orbitron:wght@900&display=swap" rel="stylesheet">
<style>
  /* ←←← THIS IS THE IMPORTANT PART →→→ */
  html,body{
    margin:0;padding:0;height:100%;width:100%;overflow:hidden;
    background:transparent;               /* transparent = perfect chroma key if you want */
    display:flex;align-items:center;justify-content:center;
    font-size:62.5%;                      /* 1rem = 10px – makes rem scaling predictable */
  }
  :root{
    --a:#a855f7;--b:rgba(8,8,28,.96);--t:#fff;--g1:#a855f7;--g2:#00e5ff;--c:#00ffaa;--s:1
  }
  .o{
    background:var(--b);padding:4rem;border-radius:3rem;border:.35rem solid var(--a);
    box-shadow:0 0 6rem var(--a),inset 0 0 4rem #a855f730;backdrop-filter:blur(1rem);
    text-align:center;max-width:95%;transform:scale(var(--s));
    /* Use rem instead of vw everywhere → perfect OBS cropping */
  }
  #t{font:900 16rem Orbitron,sans-serif;letter-spacing:.08em;color:var(--t);
     text-shadow:0 0 .5em #000;margin:0 0 1.5rem}
  #t.p{color:#f55;text-shadow:0 0 1em #f00}
  #t.b{color:var(--c);text-shadow:0 0 1.2em #0f0}
  #t.f{animation:f 1.2s}@keyframes f{50%{text-shadow:0 0 3em #0f0;color:var(--c);transform:scale(1.15)}}
  .s{font:600 5.5rem Exo 2,sans-serif;margin:1.2rem 0;color:var(--t)}
  .g{margin:3rem 0 0;background:#1e1e46c0;border-radius:2rem;padding:2.5rem;
     border:.3rem solid #333;position:relative;overflow:hidden}
  .g.c{border-color:var(--c);box-shadow:0 0 1.5rem #00ffaa80;background:#004030c0}
  .g.flash{animation:flash .25s 6}
  @keyframes flash{0%,100%{box-shadow:0 0 1.5rem #00ffaa80,0 0 4rem #0f9}
                   50%{box-shadow:0 0 3rem #0f9,0 0 6rem #0f9;background:#008040}}
  .gt{font:700 5rem Exo 2,sans-serif;margin-bottom:1rem;color:var(--t)}
  .bar{height:7rem;background:linear-gradient(90deg,var(--g1),var(--g2));
       border-radius:1.5rem;transition:width 2s cubic-bezier(0.2,0.8,0.4,1)}
  .ck{position:absolute;right:4rem;top:50%;transform:translateY(-50%);
      font-size:12rem;color:var(--c);opacity:0;animation:k 1.2s .6s forwards}
  @keyframes k{0%{opacity:0;transform:translateY(-50%) scale(.3) rotate(-45deg)}
               70%{opacity:1;transform:translateY(-50%) scale(1.3) rotate(10deg)}
               100%{opacity:1;transform:translateY(-50%) scale(1)}}
  .br{margin-top:2rem;font:500 3.8rem Exo 2,sans-serif;color:#999}
</style>
</head>
<body>

<div class="o">
  <div id="t">03:00:00</div>
  <div class="s">Raised: $<span id="r">0.00</span> • Goal: $<span id="g">10,000</span></div>
  <div class="s">Subs: <span id="s">0</span> • Bits: <span id="b">0</span></div>
  <div id="m"></div>
  <div class="br" id="n">Donothon Timer by Ceres</div>
</div>

<audio id="rs" src="https://static.wikia.nocookie.net/runescape/images/4/4f/Level_up.ogg/revision/latest" preload="auto"></audio>

<script>
// ==== SAME LOGIC AS BEFORE (only tiny cleanups) ====
const firebaseConfig = {apiKey:"AIzaSyBFQFPo85fIpaHWl3Kr0PZ6WIm5B6WVusA",authDomain:"ceres-donothon-timer.firebaseapp.com",databaseURL:"https://ceres-donothon-timer-default-rtdb.firebaseio.com",projectId:"ceres-donothon-timer"};
const PATH = 'donothon-ultimate-2025-x7k9p2m4q8z3v6n1';

firebase.initializeApp(firebaseConfig);
const db = firebase.database().ref(PATH);
const sound = document.getElementById('rs');

const doneGoals = new Set(JSON.parse(localStorage.getItem('donothon-done')||'[]'));
let cache = {};

db.child('theme').on('value',s=>{const t=s.val()||{};Object.entries(t).forEach(([k,v])=>v&&document.documentElement.style.setProperty('--'+k,v));document.documentElement.style.setProperty('--s',t.goalScale||1);});
db.child('settings').on('value',s=>document.getElementById('n').textContent=(s.val()||{}).streamerName||"Donothon Timer by Ceres");

db.on('value',snap=>{cache=snap.val()||{};updateDisplay();});
setInterval(()=>cache.endTime!==undefined&&updateTimerOnly(),200);

function updateDisplay(){
  const d=cache,cfg=d.config||{},earned=+d.totalEarned||0;
  const goals=Object.values(cfg.milestones||{}).sort((a,b)=>a.amount-b.amount);

  document.getElementById('r').textContent=earned.toFixed(2);
  document.getElementById('g').textContent=(cfg.goal||10000).toLocaleString();
  document.getElementById('s').textContent=d.subsCount||0;
  document.getElementById('b').textContent=d.bitsCount||0;

  const container=document.getElementById('m');container.innerHTML='';
  goals.filter(g=>earned<g.amount+5000).slice(0,3).forEach(goal=>{
    const complete=earned>=goal.amount,pct=complete?100:(earned/goal.amount)*100;
    const div=document.createElement('div');div.className=`g${complete?' c':''}`;

    if(complete&&!doneGoals.has(goal.amount)){
      doneGoals.add(goal.amount);localStorage.setItem('donothon-done',JSON.stringify([...doneGoals]));
      div.classList.add('flash');setTimeout(()=>div.classList.remove('flash'),1600);
      confetti({particleCount:600,spread:160,origin:{y:0.6}});
      sound.currentTime=0;sound.play().catch(()=>{});
    }

    div.innerHTML=`
      <div class="gt">$${goal.amount.toLocaleString()} → ${goal.description||'Goal'}</div>
      <div style="position:relative">
        <div class="bar" style="width:${pct}%"></div>
        ${complete?'<div class="ck">Checkmark</div>':''}
      </div>`;
    container.appendChild(div);
  });

  updateTimerOnly();
}

function updateTimerOnly(){
  const d=cache;if(!d)return;
  const end=d.endTime||Date.now()+10800000,bonus=+d.bonusSeconds||0,paused=!!d.paused,now=Date.now();
  let left=paused&&d.pausedAt?Math.floor((d.pausedAt+bonus*1000-now)/1000):Math.floor((end+bonus*1000-now)/1000);
  left=Math.max(0,left);
  const h=('0'+Math.floor(left/3600)).slice(-2);
  const m=('0'+Math.floor(left%3600/60)).slice(-2);
  const s=('0'+left%60).slice(-2);

  const t=document.getElementById('t');
  t.textContent=`${h}:${m}:${s}`;
  t.className='';
  if(bonus)t.classList.add('b');
  if(paused)t.classList.add('p');
}

updateDisplay();
</script>
</body>
</html>
