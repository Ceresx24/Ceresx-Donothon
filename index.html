<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ceres Donothon 2025</title>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-database-compat.js"></script>
<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@600;800&family=Orbitron:wght@700;900&family=Bebas+Neue&display=swap" rel="stylesheet">

<style>
  html,body{margin:0;padding:0;height:100%;width:100%;overflow:hidden;background:transparent;display:flex;align-items:center;justify-content:center}
  :root{
    --accent:#a855f7;--bg:rgba(10,8,30,0.92);--text:#ffffff;--grad1:#a855f7;--grad2:#00d4ff;--check:#00ff9d;
    --timer:16vw;--stats:5.5vw;--goal:4.8vw;--bar:7.5vw;--pad:5vw;--space:3.5vw;--radius:3.5vw;--glow:8vw
  }
  .overlay{
    background:var(--bg);padding:var(--pad);border-radius:var(--radius);border:0.4vw solid var(--accent);
    box-shadow:0 0 var(--glow) var(--accent),inset 0 0 4vw rgba(168,85,247,0.3);
    backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);text-align:center;max-width:96%
  }
  #timer{
    font-family:'Orbitron',sans-serif;font-size:var(--timer);font-weight:900;letter-spacing:0.6vw;
    color:var(--text);text-shadow:0 0 4vw #000;margin:0 0 1.5vw 0;transition:all .6s
  }
  #timer.paused{color:#ff6b6b !important;text-shadow:0 0 5vw #f00 !important}
  #timer.bonus{color:#00ff9d !important;text-shadow:0 0 6vw #0f0 !important;transform:scale(1.06)}
  .stats{font-family:'Exo 2',sans-serif;font-size:var(--stats);margin:1.2vw 0;color:var(--text);font-weight:600}
  .goal{
    background:rgba(20,20,50,0.7);border-radius:2.5vw;padding:2.2vw;margin:var(--space) 0;
    border:0.3vw solid #333;overflow:hidden;position:relative;transition:all 1s
  }
  .goal.complete{border-color:var(--check);box-shadow:0 0 3vw #00ff9d80;background:rgba(0,50,30,0.7)}
  .goal-text{font-family:'Exo 2',sans-serif;font-size:var(--goal);font-weight:700;margin-bottom:1vw}
  .bar{
    height:var(--bar);background:linear-gradient(90deg,var(--grad1),var(--grad2));border-radius:1.5vw;
    transition:width 1.8s ease;width:0%
  }
  .checkmark{position:absolute;right:3vw;top:50%;transform:translateY(-50%);font-size:12vw;color:var(--check);opacity:0;transition:opacity 1s}
  .checkmark.show{opacity:1}
  .controls{margin-top:3vw}
  .btn{
    font-family:'Exo 2',sans-serif;font-size:4vw;padding:1.8vw 4vw;margin:0 1vw;
    background:var(--accent);color:white;border:none;border-radius:2vw;cursor:pointer;
    box-shadow:0 0 3vw rgba(168,85,247,0.6);transition:all .3s
  }
  .btn:hover{transform:translateY(-0.5vw);box-shadow:0 0 5vw var(--accent)}
  .btn.pause{background:#ff4444}
  .btn.resume{background:#00aa44}
  .token{position:fixed;bottom:1vw;left:1vw;background:rgba(0,0,0,0.6);padding:0.8vw 1.2vw;border-radius:1vw;font-size:1.3vw;color:#0f0}
</style>
</head>
<body>

<div class="overlay">
  <div id="timer">03:00:00</div>
  <div class="stats">Raised: $<span id="raised">0.00</span> • Goal: $<span id="goal">10,000</span></div>
  <div class="stats">Subs: <span id="subs">0</span> • Bits: <span id="bits">0</span></div>
  <div id="goals"></div>
  <div class="controls">
    <button class="btn pause" id="pauseBtn" onclick="togglePause()">PAUSE</button>
  </div>
</div>
<div class="token" id="tokenInfo">Ceres Donothon • Donations add time</div>

<script>
const firebaseConfig = {apiKey:"AIzaSyBFQFPo85fIpaHWl3Kr0PZ6WIm5B6WVusA",authDomain:"ceres-donothon-timer.firebaseapp.com",databaseURL:"https://ceres-donothon-timer-default-rtdb.firebaseio.com",projectId:"ceres-donothon-timer",storageBucket:"ceres-donothon-timer.firebasestorage.app",messagingSenderId:"62539165670",appId:"1:62539165670:web:170c8110449deba628b027"};
const PATH = 'donothon-ultimate-2025-x7k9p2m4q8z3v6n1';
firebase.initializeApp(firebaseConfig);
const db = firebase.database().ref(PATH);

let earned = 0, completed = new Set();

// Apply theme
db.child('theme').on('value', s => {
  const t = s.val()||{};
  Object.entries(t).forEach(([k,v]) => v && document.documentElement.style.setProperty('--'+k,v));
});

// Main timer + pause system
db.on('value', s => {
  const d = s.val()||{};
  const c = d.config||{};
  earned = Number(d.totalEarned)||0;

  const baseEnd = d.endTime || (Date.now() + 3*60*60*1000); // 3 hours default
  const bonus = Number(d.bonusSeconds)||0;
  const left = Math.max(0, Math.floor((baseEnd + bonus*1000 - Date.now())/1000));

  const h = String(Math.floor(left/3600)).padStart(2,'0');
  const m = String(Math.floor(left%3600/60)).padStart(2,'0');
  const sec = String(left%60).padStart(2,'0');

  const timer = document.getElementById('timer');
  timer.textContent = `${h}:${m}:${sec}`;
  timer.classList.toggle('bonus', bonus > 0);
  timer.classList.toggle('paused', !!d.paused);

  document.getElementById('raised').textContent = earned.toFixed(2);
  document.getElementById('goal').textContent = (c.goal||10000).toLocaleString();
  document.getElementById('subs').textContent = d.subsCount||0;
  document.getElementById('bits').textContent = d.bitsCount||0;

  // Goals
  const container = document.getElementById('goals'); container.innerHTML = '';
  const goals = Object.values(c.milestones||{}).sort((a,b)=>a.amount-b.amount);
  goals.filter(g=>earned < g.amount+5000).slice(0,3).forEach(g => {
    const complete = earned >= g.amount;
    const pct = Math.min(100, (earned/g.amount)*100);
    const row = document.createElement('div'); row.className = `goal ${complete?'complete':''}`;
    row.innerHTML = `
      <div class="goal-text">$${g.amount.toLocaleString()} → ${g.description}</div>
      <div style="position:relative"><div class="bar" style="width:${pct}%"></div>
      <div class="checkmark ${complete?'show':''}">CHECKMARK</div></div>`;
    if(complete && !completed.has(g.amount)){completed.add(g.amount);confetti({particleCount:500,spread:120,origin:{y:0.6}});}
    container.appendChild(row);
  });
});

// PAUSE / RESUME
function togglePause() {
  db.once('value').then(s => {
    const d = s.val()||{};
    if (d.paused) {
      const remaining = Math.floor((d.pausedAt + (d.bonusSeconds||0)*1000 - Date.now())/1000);
      db.update({endTime:Date.now() + remaining*1000, paused:false, pausedAt:null});
    } else {
      db.update({paused:true, pausedAt:d.endTime || Date.now()});
    }
  });
}

// Token connection (donations/bits/subs add time) — same working code
const params = new URLSearchParams(location.search);
const token = params.get('token')||params.get('sl')||params.get('se')||'';
if(token){/* your full working token code here */}
</script>
</body>
</html>
